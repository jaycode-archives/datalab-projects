<!DOCTYPE html>
<!-- saved from url=(0162)https://main-dot-datalab-dot-datalab-projects-1331.appspot.com/notebooks/Xiaojukeji%20Algorithm%20Competition/(archive)%204.%20Create%20Baseline%20Algorithm.ipynb -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>(archive) 4. Create Baseline Algorithm</title>
  <link rel="shortcut icon" type="image/x-icon" href="https://main-dot-datalab-dot-datalab-projects-1331.appspot.com/static/favicon.ico">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="./(archive) 4. Create Baseline Algorithm_files/codemirror.css">
  <link rel="stylesheet" href="./(archive) 4. Create Baseline Algorithm_files/style.min.css" type="text/css">
  <link rel="stylesheet" href="./(archive) 4. Create Baseline Algorithm_files/custom.css" type="text/css">
<script async="" src="./(archive) 4. Create Baseline Algorithm_files/analytics.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="services/contents" src="./(archive) 4. Create Baseline Algorithm_files/contents.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="custom/custom" src="./(archive) 4. Create Baseline Algorithm_files/custom.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="nbextensions/widgets/notebook/js/extension" src="./(archive) 4. Create Baseline Algorithm_files/extension.js"></script></head>
<body class="notebook_app command_mode" data-project="" data-base-url="/" data-ws-url="" data-notebook-name="4.%20Create%20Baseline%20Algorithm-Copy1.ipynb" data-notebook-path="Xiaojukeji%20Algorithm%20Competition/4.%20Create%20Baseline%20Algorithm-Copy1.ipynb" data-feedback-id="717112" data-analytics-id="UA-54894152-3" data-analytics-path="bbd6acc3106d3a0f16ee634401dd214c6bd6f5c6550184f8a18976a310f9fcdd" data-analytics-title="notebook" data-project-num="803616047008" data-project-id="datalab-projects-1331" data-version-id="0.5.20160527" data-instance-id="561b5a45-7726-484a-bbc6-1ee1e59337b3" data-instance-name="main" data-user-id="TeguhWPurwanto@gmail.com" style="">
  <div id="app">
    <div id="appBar">
      <span id="logo" class="nav navbar-brand pull-left">
        <a href="https://main-dot-datalab-dot-datalab-projects-1331.appspot.com/tree"><img src="./(archive) 4. Create Baseline Algorithm_files/logo.png" alt="Google Cloud DataLab"></a>
      </span>
      <span id="save_widget" class="pull-left save_widget">
        <button class="btn" title="Rename notebook"><span id="notebook_name" class="filename">(archive) 4. Create Baseline Algorithm</span></button>
        <span class="autosave_status">(autosaved)</span>
      </span>
      <div class="btn-toolbar pull-right">
        <div class="btn-group">
          <button class="btn" data-toggle="dropdown" title="Help Links">
            <span class="fa fa-question-circle"></span>
          </button>
          <ul class="dropdown-menu dropdown-menu-right">
            <li><a id="keyboardHelpLink" href="https://main-dot-datalab-dot-datalab-projects-1331.appspot.com/notebooks/Xiaojukeji%20Algorithm%20Competition/(archive)%204.%20Create%20Baseline%20Algorithm.ipynb#">Keyboard Shortcuts</a></li>
            <li><a id="markdownHelpLink" href="https://main-dot-datalab-dot-datalab-projects-1331.appspot.com/notebooks/Xiaojukeji%20Algorithm%20Competition/(archive)%204.%20Create%20Baseline%20Algorithm.ipynb#">Markdown Syntax</a></li>
            <li class="divider"></li>
            <li><a href="https://cloud.google.com/bigquery/what-is-bigquery" target="_blank"><i class="fa fa-external-link pull-right menu-icon"></i><span>BigQuery&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></a></li>
            <li><a href="https://cloud.google.com/storage/docs/overview" target="_blank"><i class="fa fa-external-link pull-right menu-icon"></i><span>Cloud Storage&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></a></li>
            <li class="divider"></li>
            <li><a href="https://developers.google.com/chart/" target="_blank"><i class="fa fa-external-link pull-right menu-icon"></i><span>Google Charts</span></a></li>
            <li><a href="http://matplotlib.org/contents.html" target="_blank"><i class="fa fa-external-link pull-right menu-icon"></i><span>Matplotlib</span></a></li>
            <li><a href="http://pandas.pydata.org/pandas-docs/stable/" target="_blank"><i class="fa fa-external-link pull-right menu-icon"></i><span>Pandas</span></a></li>
            <li><a href="http://scikit-learn.org/stable/" target="_blank"><i class="fa fa-external-link pull-right menu-icon"></i><span>SciKit-Learn</span></a></li>
          </ul>
        </div>
        <div class="btn-group">
          <button class="btn" data-toggle="dropdown" title="User and Project Information">
            <span class="fa fa-user"></span>
          </button>
          <ul class="dropdown-menu dropdown-menu-right">
            <li><a href="https://main-dot-datalab-dot-datalab-projects-1331.appspot.com/notebooks/Xiaojukeji%20Algorithm%20Competition/(archive)%204.%20Create%20Baseline%20Algorithm.ipynb#" id="userId">TeguhWPurwanto@gmail.com</a></li>
            <li class="divider"></li>
            <li><a href="https://console.developers.google.com/project/datalab-projects-1331" id="consoleLink" target="_blank">Developer Console</a></li>
            <li><a href="https://console.developers.google.com/project/datalab-projects-1331/appengine/versions?moduleId=datalab" id="instancesLink" target="_blank">Developer Console: Cloud Datalab Instances</a></li>
            <li><a href="https://console.developers.google.com/project/datalab-projects-1331/clouddev/develop/browse/default/datalab_main" id="repoLink" target="_blank">Developer Console: Git Repository</a></li>
          </ul>
        </div>
        <div class="btn-group">
          <button id="feedbackButton" title="Provide feedback">
            <span class="fa fa-comment"></span>
          </button>
        </div>
        <div class="btn-group">
          <button id="aboutButton" title="About Google Cloud Datalab">
            <span class="fa fa-info-circle"></span>
          </button>
        </div>
      </div>
    </div>
    <div id="appContent">
      <div id="mainArea">
        <div id="mainToolbar">
          <div class="btn-toolbar pull-left">
            <div class="btn-group">
              <button type="button" class="btn" data-toggle="dropdown" title="Notebook commands">
                <span class="fa fa-book"></span> Notebook <span class="caret"></span>
              </button>
              <ul class="dropdown-menu">
                <li id="saveButton"><a href="https://main-dot-datalab-dot-datalab-projects-1331.appspot.com/notebooks/Xiaojukeji%20Algorithm%20Competition/(archive)%204.%20Create%20Baseline%20Algorithm.ipynb#">Save</a></li>
                <li id="saveCopyButton"><a href="https://main-dot-datalab-dot-datalab-projects-1331.appspot.com/notebooks/Xiaojukeji%20Algorithm%20Competition/(archive)%204.%20Create%20Baseline%20Algorithm.ipynb#">Save copy</a></li>
                <li id="renameButton"><a href="https://main-dot-datalab-dot-datalab-projects-1331.appspot.com/notebooks/Xiaojukeji%20Algorithm%20Competition/(archive)%204.%20Create%20Baseline%20Algorithm.ipynb#">Rename...</a></li>
                <li class="divider"></li>
                <li id="downloadButton"><a href="https://main-dot-datalab-dot-datalab-projects-1331.appspot.com/notebooks/Xiaojukeji%20Algorithm%20Competition/(archive)%204.%20Create%20Baseline%20Algorithm.ipynb#">Download</a></li>
                <li class="divider"></li>
                <li id="convertHTMLButton"><a href="https://main-dot-datalab-dot-datalab-projects-1331.appspot.com/notebooks/Xiaojukeji%20Algorithm%20Competition/(archive)%204.%20Create%20Baseline%20Algorithm.ipynb#">Convert to HTML</a></li>
                <li id="convertPythonButton"><a href="https://main-dot-datalab-dot-datalab-projects-1331.appspot.com/notebooks/Xiaojukeji%20Algorithm%20Competition/(archive)%204.%20Create%20Baseline%20Algorithm.ipynb#">Convert to Python</a></li>
              </ul>
            </div>
          </div>
          <div class="btn-toolbar pull-right">
            <div class="btn-group">
              <button id="addCodeCellButton" type="button" class="btn" title="Append a new code cell">
                <span class="fa fa-plus-square"></span> Add Code
              </button>
              <button id="addMarkdownCellButton" type="button" class="btn" title="Append a new markdown cell">
                <span class="fa fa-plus-square"></span> Add Markdown
              </button>
              <button id="deleteCellButton" type="button" class="btn" title="Delete the selected cell">
                <span class="fa fa-minus-square"></span> Delete
              </button>
              <button id="moveCellUpButton" type="button" class="btn" title="Move the selected cell up">
                <span class="fa fa-chevron-up"></span> Move Up
              </button>
              <button id="moveCellDownButton" type="button" class="btn" title="Move the selected cell down">
                <span class="fa fa-chevron-down"></span> Move Down
              </button>
            </div>
            <div class="btn-group">
              <button id="runButton" type="button" class="btn" title="Run the selected cell">
                <span class="fa fa-play"></span> Run
              </button>
              <button type="button" class="btn dropdown-toggle" data-toggle="dropdown">
                <span class="caret"></span>
              </button>
              <ul class="dropdown-menu">
                <li id="runAllButton"><a href="https://main-dot-datalab-dot-datalab-projects-1331.appspot.com/notebooks/Xiaojukeji%20Algorithm%20Competition/(archive)%204.%20Create%20Baseline%20Algorithm.ipynb#">Run all Cells</a></li>
                <li id="runToButton"><a href="https://main-dot-datalab-dot-datalab-projects-1331.appspot.com/notebooks/Xiaojukeji%20Algorithm%20Competition/(archive)%204.%20Create%20Baseline%20Algorithm.ipynb#">Run to this Cell</a></li>
                <li id="runFromButton"><a href="https://main-dot-datalab-dot-datalab-projects-1331.appspot.com/notebooks/Xiaojukeji%20Algorithm%20Competition/(archive)%204.%20Create%20Baseline%20Algorithm.ipynb#">Run from this Cell</a></li>
              </ul>
            </div>
            <div class="btn-group">
              <button id="clearButton" type="button" class="btn" title="Clear outputs of the selected cell">
                <span class="fa fa-minus-square-o"></span> Clear
              </button>
              <button type="button" class="btn dropdown-toggle" data-toggle="dropdown">
                <span class="caret"></span>
              </button>
              <ul class="dropdown-menu">
                <li id="clearAllButton"><a href="https://main-dot-datalab-dot-datalab-projects-1331.appspot.com/notebooks/Xiaojukeji%20Algorithm%20Competition/(archive)%204.%20Create%20Baseline%20Algorithm.ipynb#">Clear all Cells</a></li>
              </ul>
            </div>
            <div class="btn-group">
              <button id="resetSessionButton" type="button" class="btn" title="Restart the current notebook session">
                <i id="kernel_indicator_icon" class="kernel_idle_icon" title="Kernel Idle"></i> Reset Session
              </button>
            </div>
          </div>
        </div>
        <div id="mainContent" class="container">
          <div id="ipython-main-app">
            <div id="notebook_panel" style="position: relative">
              <div id="notebook" tabindex="-1"><div class="container" id="notebook-container"><div class="cell code_cell rendered selected" tabindex="2"><div class="input"><div class="prompt input_prompt">In&nbsp;[18]:</div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 6px; left: 6px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-width: 867px; margin-bottom: -17px; border-right-width: 13px; min-height: 747px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 21px;">&nbsp;</div></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">pdb</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">numpy</span> <span class="cm-keyword">as</span> <span class="cm-variable">np</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">gcp</span>.<span class="cm-variable">bigquery</span> <span class="cm-keyword">as</span> <span class="cm-variable">bq</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">gcp</span>.<span class="cm-variable">storage</span> <span class="cm-keyword">as</span> <span class="cm-variable">storage</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">sklearn</span>.<span class="cm-variable">pipeline</span> <span class="cm-keyword">import</span> <span class="cm-variable">Pipeline</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">try</span>:</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">   <span class="cm-keyword cm-error">import</span> <span class="cm-variable">cPickle</span> <span class="cm-keyword">as</span> <span class="cm-variable">pickle</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">except</span>:</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">   <span class="cm-keyword cm-error">import</span> <span class="cm-variable">pickle</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">EST_PICKLE_FILENAME</span> = <span class="cm-string">'baseline_final_estimator.pkl'</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text="">&#8203;</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment"># First feature HAS to be 'district_id' for MAPE calculation.</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">fields_str</span> = <span class="cm-string">"""</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-string">gap<span class="cm-tab" role="presentation" cm-text="	"> </span>district_id<span class="cm-tab" role="presentation" cm-text="	"> </span>day_in_week<span class="cm-tab" role="presentation" cm-text="	"> </span>timeofday_slot<span class="cm-tab" role="presentation" cm-text="	">  </span>tj_level1_1_slots_ago<span class="cm-tab" role="presentation" cm-text="	">   </span>tj_level2_1_slots_ago<span class="cm-tab" role="presentation" cm-text="	">   </span></span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-string">tj_level3_1_slots_ago<span class="cm-tab" role="presentation" cm-text="	">   </span>tj_level4_1_slots_ago<span class="cm-tab" role="presentation" cm-text="	">   </span>tj_level1_2_slots_ago<span class="cm-tab" role="presentation" cm-text="	">   </span>tj_level2_2_slots_ago<span class="cm-tab" role="presentation" cm-text="	">   </span></span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-string">tj_level3_2_slots_ago<span class="cm-tab" role="presentation" cm-text="	">   </span>tj_level4_2_slots_ago<span class="cm-tab" role="presentation" cm-text="	">   </span>tj_level1_3_slots_ago<span class="cm-tab" role="presentation" cm-text="	">   </span>tj_level2_3_slots_ago<span class="cm-tab" role="presentation" cm-text="	">   </span></span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-string">tj_level3_3_slots_ago<span class="cm-tab" role="presentation" cm-text="	">   </span>tj_level4_3_slots_ago<span class="cm-tab" role="presentation" cm-text="	">   </span>weather_1_slots_ago<span class="cm-tab" role="presentation" cm-text="	"> </span>temperature_1_slots_ago<span class="cm-tab" role="presentation" cm-text="	"> </span></span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-string">pm25_1_slots_ago<span class="cm-tab" role="presentation" cm-text="	">    </span>weather_2_slots_ago<span class="cm-tab" role="presentation" cm-text="	"> </span>temperature_2_slots_ago<span class="cm-tab" role="presentation" cm-text="	"> </span>pm25_2_slots_ago<span class="cm-tab" role="presentation" cm-text="	">    </span></span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-string">weather_3_slots_ago<span class="cm-tab" role="presentation" cm-text="	"> </span>temperature_3_slots_ago<span class="cm-tab" role="presentation" cm-text="	"> </span>pm25_3_slots_ago<span class="cm-tab" role="presentation" cm-text="	">    </span>gap_1_slots_ago<span class="cm-tab" role="presentation" cm-text="	"> </span></span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-string">sum_price_1_slots_ago<span class="cm-tab" role="presentation" cm-text="	">   </span>gap_2_slots_ago<span class="cm-tab" role="presentation" cm-text="	"> </span>sum_price_2_slots_ago<span class="cm-tab" role="presentation" cm-text="	">   </span>gap_3_slots_ago<span class="cm-tab" role="presentation" cm-text="	"> </span></span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-string">sum_price_3_slots_ago<span class="cm-tab" role="presentation" cm-text="	">   </span>f1<span class="cm-tab" role="presentation" cm-text="	">  </span>f11<span class="cm-tab" role="presentation" cm-text="	"> </span>f11_1<span class="cm-tab" role="presentation" cm-text="	">   </span>f11_2<span class="cm-tab" role="presentation" cm-text="	">   </span>f11_3<span class="cm-tab" role="presentation" cm-text="	">   </span>f11_4<span class="cm-tab" role="presentation" cm-text="	">   </span>f11_5<span class="cm-tab" role="presentation" cm-text="	">   </span>f11_6<span class="cm-tab" role="presentation" cm-text="	">   </span>f11_7<span class="cm-tab" role="presentation" cm-text="	">   </span></span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-string">f11_8<span class="cm-tab" role="presentation" cm-text="	">   </span>f13_4<span class="cm-tab" role="presentation" cm-text="	">   </span>f13_8<span class="cm-tab" role="presentation" cm-text="	">   </span>f14<span class="cm-tab" role="presentation" cm-text="	"> </span>f14_1<span class="cm-tab" role="presentation" cm-text="	">   </span>f14_10<span class="cm-tab" role="presentation" cm-text="	">  </span>f14_2<span class="cm-tab" role="presentation" cm-text="	">   </span>f14_3<span class="cm-tab" role="presentation" cm-text="	">   </span>f14_6<span class="cm-tab" role="presentation" cm-text="	">   </span>f14_8<span class="cm-tab" role="presentation" cm-text="	">   </span>f15<span class="cm-tab" role="presentation" cm-text="	"> </span>f15_1<span class="cm-tab" role="presentation" cm-text="	">   </span></span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-string">f15_2<span class="cm-tab" role="presentation" cm-text="	">   </span>f15_3<span class="cm-tab" role="presentation" cm-text="	">   </span>f15_4<span class="cm-tab" role="presentation" cm-text="	">   </span>f15_6<span class="cm-tab" role="presentation" cm-text="	">   </span>f15_7<span class="cm-tab" role="presentation" cm-text="	">   </span>f15_8<span class="cm-tab" role="presentation" cm-text="	">   </span>f16<span class="cm-tab" role="presentation" cm-text="	"> </span>f16_1<span class="cm-tab" role="presentation" cm-text="	">   </span>f16_10<span class="cm-tab" role="presentation" cm-text="	">  </span>f16_11<span class="cm-tab" role="presentation" cm-text="	">  </span>f16_12<span class="cm-tab" role="presentation" cm-text="	">  </span>f16_3<span class="cm-tab" role="presentation" cm-text="	">   </span></span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-string">f16_4<span class="cm-tab" role="presentation" cm-text="	">   </span>f16_6<span class="cm-tab" role="presentation" cm-text="	">   </span>f17<span class="cm-tab" role="presentation" cm-text="	"> </span>f17_2<span class="cm-tab" role="presentation" cm-text="	">   </span>f17_3<span class="cm-tab" role="presentation" cm-text="	">   </span>f17_4<span class="cm-tab" role="presentation" cm-text="	">   </span>f17_5<span class="cm-tab" role="presentation" cm-text="	">   </span>f19<span class="cm-tab" role="presentation" cm-text="	"> </span>f19_1<span class="cm-tab" role="presentation" cm-text="	">   </span>f19_2<span class="cm-tab" role="presentation" cm-text="	">   </span>f19_3<span class="cm-tab" role="presentation" cm-text="	">   </span>f19_4<span class="cm-tab" role="presentation" cm-text="	">   </span>f1_1<span class="cm-tab" role="presentation" cm-text="	">    </span></span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-string">f1_10<span class="cm-tab" role="presentation" cm-text="	">   </span>f1_11<span class="cm-tab" role="presentation" cm-text="	">   </span>f1_2<span class="cm-tab" role="presentation" cm-text="	">    </span>f1_3<span class="cm-tab" role="presentation" cm-text="	">    </span>f1_4<span class="cm-tab" role="presentation" cm-text="	">    </span>f1_5<span class="cm-tab" role="presentation" cm-text="	">    </span>f1_6<span class="cm-tab" role="presentation" cm-text="	">    </span>f1_7<span class="cm-tab" role="presentation" cm-text="	">    </span>f1_8<span class="cm-tab" role="presentation" cm-text="	">    </span>f20<span class="cm-tab" role="presentation" cm-text="	"> </span>f20_1<span class="cm-tab" role="presentation" cm-text="	">   </span>f20_2<span class="cm-tab" role="presentation" cm-text="	">   </span></span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-string">f20_4<span class="cm-tab" role="presentation" cm-text="	">   </span>f20_5<span class="cm-tab" role="presentation" cm-text="	">   </span>f20_6<span class="cm-tab" role="presentation" cm-text="	">   </span>f20_7<span class="cm-tab" role="presentation" cm-text="	">   </span>f20_8<span class="cm-tab" role="presentation" cm-text="	">   </span>f20_9<span class="cm-tab" role="presentation" cm-text="	">   </span>f21_1<span class="cm-tab" role="presentation" cm-text="	">   </span>f21_2<span class="cm-tab" role="presentation" cm-text="	">   </span>f22<span class="cm-tab" role="presentation" cm-text="	"> </span>f22_1<span class="cm-tab" role="presentation" cm-text="	">   </span>f22_2<span class="cm-tab" role="presentation" cm-text="	">   </span>f22_3<span class="cm-tab" role="presentation" cm-text="	">   </span></span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-string">f22_4<span class="cm-tab" role="presentation" cm-text="	">   </span>f22_5<span class="cm-tab" role="presentation" cm-text="	">   </span>f23<span class="cm-tab" role="presentation" cm-text="	"> </span>f23_1<span class="cm-tab" role="presentation" cm-text="	">   </span>f23_2<span class="cm-tab" role="presentation" cm-text="	">   </span>f23_3<span class="cm-tab" role="presentation" cm-text="	">   </span>f23_4<span class="cm-tab" role="presentation" cm-text="	">   </span>f23_5<span class="cm-tab" role="presentation" cm-text="	">   </span>f23_6<span class="cm-tab" role="presentation" cm-text="	">   </span>f24<span class="cm-tab" role="presentation" cm-text="	"> </span>f24_1<span class="cm-tab" role="presentation" cm-text="	">   </span>f24_2<span class="cm-tab" role="presentation" cm-text="	">   </span>f24_3<span class="cm-tab" role="presentation" cm-text="	">   </span></span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-string">f25<span class="cm-tab" role="presentation" cm-text="	"> </span>f25_1<span class="cm-tab" role="presentation" cm-text="	">   </span>f25_3<span class="cm-tab" role="presentation" cm-text="	">   </span>f25_7<span class="cm-tab" role="presentation" cm-text="	">   </span>f25_8<span class="cm-tab" role="presentation" cm-text="	">   </span>f25_9<span class="cm-tab" role="presentation" cm-text="	">   </span>f2_1<span class="cm-tab" role="presentation" cm-text="	">    </span>f2_10<span class="cm-tab" role="presentation" cm-text="	">   </span>f2_11<span class="cm-tab" role="presentation" cm-text="	">   </span>f2_12<span class="cm-tab" role="presentation" cm-text="	">   </span>f2_13<span class="cm-tab" role="presentation" cm-text="	">   </span>f2_2<span class="cm-tab" role="presentation" cm-text="	">    </span></span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-string">f2_4<span class="cm-tab" role="presentation" cm-text="	">    </span>f2_5<span class="cm-tab" role="presentation" cm-text="	">    </span>f2_6<span class="cm-tab" role="presentation" cm-text="	">    </span>f2_7<span class="cm-tab" role="presentation" cm-text="	">    </span>f2_8<span class="cm-tab" role="presentation" cm-text="	">    </span>f3_1<span class="cm-tab" role="presentation" cm-text="	">    </span>f3_2<span class="cm-tab" role="presentation" cm-text="	">    </span>f3_3<span class="cm-tab" role="presentation" cm-text="	">    </span>f4<span class="cm-tab" role="presentation" cm-text="	">  </span>f4_1<span class="cm-tab" role="presentation" cm-text="	">    </span>f4_10<span class="cm-tab" role="presentation" cm-text="	">   </span>f4_11<span class="cm-tab" role="presentation" cm-text="	">   </span></span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-string">f4_13<span class="cm-tab" role="presentation" cm-text="	">   </span>f4_14<span class="cm-tab" role="presentation" cm-text="	">   </span>f4_16<span class="cm-tab" role="presentation" cm-text="	">   </span>f4_17<span class="cm-tab" role="presentation" cm-text="	">   </span>f4_18<span class="cm-tab" role="presentation" cm-text="	">   </span>f4_2<span class="cm-tab" role="presentation" cm-text="	">    </span>f4_3<span class="cm-tab" role="presentation" cm-text="	">    </span>f4_5<span class="cm-tab" role="presentation" cm-text="	">    </span>f4_6<span class="cm-tab" role="presentation" cm-text="	">    </span>f4_7<span class="cm-tab" role="presentation" cm-text="	">    </span>f4_8<span class="cm-tab" role="presentation" cm-text="	">    </span>f4_9<span class="cm-tab" role="presentation" cm-text="	">    </span></span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-string">f5<span class="cm-tab" role="presentation" cm-text="	">  </span>f5_1<span class="cm-tab" role="presentation" cm-text="	">    </span>f5_3<span class="cm-tab" role="presentation" cm-text="	">    </span>f5_4<span class="cm-tab" role="presentation" cm-text="	">    </span>f6<span class="cm-tab" role="presentation" cm-text="	">  </span>f6_1<span class="cm-tab" role="presentation" cm-text="	">    </span>f6_2<span class="cm-tab" role="presentation" cm-text="	">    </span>f6_4<span class="cm-tab" role="presentation" cm-text="	">    </span>f7<span class="cm-tab" role="presentation" cm-text="	">  </span>f8<span class="cm-tab" role="presentation" cm-text="	">  </span>f8_1<span class="cm-tab" role="presentation" cm-text="	">    </span>f8_2<span class="cm-tab" role="presentation" cm-text="	">    </span>f8_3<span class="cm-tab" role="presentation" cm-text="	">    </span>f8_4<span class="cm-tab" role="presentation" cm-text="	">    </span></span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-string">f8_5</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-string">"""</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">fields</span> = <span class="cm-builtin">map</span>(<span class="cm-keyword">lambda</span> <span class="cm-variable">x</span>: <span class="cm-variable">x</span>.<span class="cm-variable">strip</span>(), <span class="cm-variable">fields_str</span>.<span class="cm-variable">split</span>(<span class="cm-string">'\t'</span>))</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">features</span> = <span class="cm-variable">fields</span>[<span class="cm-number">1</span>:]</span></pre></div></div></div></div></div><div style="position: absolute; height: 13px; width: 1px; top: 747px;"></div><div class="CodeMirror-gutters" style="display: none; height: 760px;"></div></div></div></div></div></div><div class="output_wrapper"><div class="out_prompt_overlay prompt" title="click to expand output; double click to hide output" style="display: block;"></div><div class="output" style=""><div class="output_area"><div class="prompt"></div><div class="output_subarea output_text output_stream output_stdout"><pre>
</pre></div></div></div><div class="btn btn-default output_collapsed" title="click to expand output" style="display: none;">. . .</div></div></div><div class="cell text_cell unselected rendered" tabindex="2"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area"><div class="CodeMirror cm-s-default CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 6px; left: 6px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; padding-right: 0px; padding-bottom: 0px; margin-bottom: -17px; border-right-width: 13px; min-height: 33px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 21px;">&nbsp;</div></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-header cm-header-1"># Scorer Creation (MAPE)</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 13px; width: 1px; top: 33px;"></div><div class="CodeMirror-gutters" style="display: none; height: 46px;"></div></div></div></div><div class="text_cell_render rendered_html" tabindex="-1"><h1 id="Scorer-Creation-(MAPE)">Scorer Creation (MAPE)<a class="anchor-link" href="https://main-dot-datalab-dot-datalab-projects-1331.appspot.com/notebooks/Xiaojukeji%20Algorithm%20Competition/(archive)%204.%20Create%20Baseline%20Algorithm.ipynb#Scorer-Creation-(MAPE)">¶</a></h1>
</div></div></div><div class="cell code_cell unselected rendered" tabindex="2"><div class="input"><div class="prompt input_prompt">In&nbsp;[19]:</div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 6px; left: 6px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-width: 525px; margin-bottom: -17px; border-right-width: 13px; min-height: 474px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 21px;">&nbsp;</div></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">def</span> <span class="cm-def">mape</span>(<span class="cm-variable">X</span>, <span class="cm-variable">predictions</span>, <span class="cm-variable">y</span>):</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable cm-error">num_timeslots</span> = <span class="cm-number">43</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable">num_districts</span> = <span class="cm-number">66</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-keyword cm-error">if</span> <span class="cm-builtin">len</span>(<span class="cm-variable">y</span>.<span class="cm-variable">shape</span>) <span class="cm-operator">==</span> <span class="cm-number">1</span>:</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-variable">y</span> = <span class="cm-variable">np</span>.<span class="cm-variable">asmatrix</span>(<span class="cm-variable">y</span>)</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-keyword cm-error">if</span> <span class="cm-builtin">len</span>(<span class="cm-variable">predictions</span>.<span class="cm-variable">shape</span>) <span class="cm-operator">==</span> <span class="cm-number">1</span>:</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-variable">predictions</span> = <span class="cm-variable">np</span>.<span class="cm-variable">asmatrix</span>(<span class="cm-variable">predictions</span>)</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable cm-error">Xy</span> = <span class="cm-variable">np</span>.<span class="cm-variable">concatenate</span>((<span class="cm-variable">X</span>, <span class="cm-variable">y</span>.<span class="cm-variable">T</span>, <span class="cm-variable">predictions</span>.<span class="cm-variable">T</span>), <span class="cm-variable">axis</span>=<span class="cm-number">1</span>)</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable">districts</span> = <span class="cm-variable">np</span>.<span class="cm-variable">unique</span>(<span class="cm-variable">X</span>[:,<span class="cm-number">0</span>])</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable cm-error">district_scores</span> = <span class="cm-variable">np</span>.<span class="cm-variable">zeros</span>(<span class="cm-builtin">len</span>(<span class="cm-variable">districts</span>))</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-keyword">for</span> <span class="cm-variable">counter</span>, <span class="cm-variable">key</span> <span class="cm-keyword">in</span> <span class="cm-builtin">enumerate</span>(<span class="cm-variable">districts</span>):</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-variable">group</span> = <span class="cm-variable">np</span>.<span class="cm-variable">compress</span>((<span class="cm-variable">Xy</span>[:,<span class="cm-number">0</span>] <span class="cm-operator">==</span> <span class="cm-variable">key</span>).<span class="cm-variable">flat</span>, <span class="cm-variable">Xy</span>, <span class="cm-variable">axis</span>=<span class="cm-number">0</span>)</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-variable">district_scores</span>[<span class="cm-variable">counter</span>] = <span class="cm-variable">np</span>.<span class="cm-builtin">sum</span>(<span class="cm-variable">np</span>.<span class="cm-variable">absolute</span>(</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">        (<span class="cm-variable">group</span>[:,<span class="cm-operator">-</span><span class="cm-number">2</span>] <span class="cm-operator">-</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">         <span class="cm-variable">group</span>[:,<span class="cm-operator">-</span><span class="cm-number">1</span>])<span class="cm-operator">/</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">        <span class="cm-variable">group</span>[:,<span class="cm-operator">-</span><span class="cm-number">2</span>]</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">      )) <span class="cm-operator">/</span> <span class="cm-variable">num_timeslots</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-keyword cm-error">return</span> <span class="cm-variable">np</span>.<span class="cm-builtin">sum</span>(<span class="cm-variable">district_scores</span>) <span class="cm-operator">/</span> <span class="cm-variable">num_districts</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text="">&#8203;</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">def</span> <span class="cm-def">mape_scorer</span>(<span class="cm-variable">estimator</span>, <span class="cm-variable">X</span>, <span class="cm-variable">y</span>):</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable cm-error">predictions</span> = <span class="cm-variable">estimator</span>.<span class="cm-variable">predict</span>(<span class="cm-variable">X</span>)</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-keyword">return</span> <span class="cm-operator">-</span><span class="cm-variable">mape</span>(<span class="cm-variable">X</span>, <span class="cm-variable">predictions</span>, <span class="cm-variable">y</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 13px; width: 1px; top: 474px;"></div><div class="CodeMirror-gutters" style="display: none; height: 487px;"></div></div></div></div></div></div><div class="output_wrapper"><div class="out_prompt_overlay prompt" title="click to expand output; double click to hide output" style="display: none;"></div><div class="output" style="display: none;"></div><div class="btn btn-default output_collapsed" title="click to expand output" style="display: none;">. . .</div></div></div><div class="cell text_cell unselected rendered" tabindex="2"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area"><div class="CodeMirror cm-s-default CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 6px; left: 6px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; padding-right: 0px; padding-bottom: 0px; margin-bottom: -17px; border-right-width: 13px; min-height: 33px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 21px;">&nbsp;</div></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">Testing MAPE</span></pre></div></div></div></div></div><div style="position: absolute; height: 13px; width: 1px; top: 33px;"></div><div class="CodeMirror-gutters" style="display: none; height: 46px;"></div></div></div></div><div class="text_cell_render rendered_html" tabindex="-1"><p>Testing MAPE</p>
</div></div></div><div class="cell code_cell unselected rendered" tabindex="2"><div class="input"><div class="prompt input_prompt">In&nbsp;[20]:</div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 6px; left: 6px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-width: 462px; margin-bottom: -17px; border-right-width: 13px; min-height: 201px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 21px;">&nbsp;</div></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">sklearn</span>.<span class="cm-variable">linear_model</span> <span class="cm-keyword">import</span> <span class="cm-variable">LogisticRegression</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text="">&#8203;</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">est</span> = <span class="cm-variable">LogisticRegression</span>()</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">X</span> = <span class="cm-variable">np</span>.<span class="cm-variable">array</span>([[<span class="cm-number">1</span>, <span class="cm-number">1</span>], [<span class="cm-number">1</span>, <span class="cm-number">2</span>], [<span class="cm-number">2</span>, <span class="cm-number">3</span>], [<span class="cm-number">2</span>, <span class="cm-number">4</span>]])</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">predictions</span> = <span class="cm-variable">np</span>.<span class="cm-variable">array</span>([<span class="cm-number">1</span>, <span class="cm-number">2</span>, <span class="cm-number">3</span>, <span class="cm-number">4</span>])</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">y</span> = <span class="cm-variable">np</span>.<span class="cm-variable">array</span>([<span class="cm-number">1</span>, <span class="cm-number">2</span>, <span class="cm-number">3</span>, <span class="cm-number">4</span>])</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text="">&#8203;</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment"># Should return 0.0</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">mape</span>(<span class="cm-variable">X</span>, <span class="cm-variable">predictions</span>, <span class="cm-variable">y</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 13px; width: 1px; top: 201px;"></div><div class="CodeMirror-gutters" style="display: none; height: 214px;"></div></div></div></div></div></div><div class="output_wrapper"><div class="out_prompt_overlay prompt" title="click to expand output; double click to hide output" style="display: block;"></div><div class="output" style=""><div class="output_area"><div class="prompt output_prompt">Out[20]:</div><div class="output_subarea output_text output_result"><pre>0.0</pre></div></div></div><div class="btn btn-default output_collapsed" title="click to expand output" style="display: none;">. . .</div></div></div><div class="cell text_cell unselected rendered" tabindex="2"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area"><div class="CodeMirror cm-s-default CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 6px; left: 6px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; padding-right: 0px; padding-bottom: 0px; margin-bottom: -17px; border-right-width: 13px; min-height: 33px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 21px;">&nbsp;</div></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-header cm-header-1"># Feature Selection</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 13px; width: 1px; top: 33px;"></div><div class="CodeMirror-gutters" style="display: none; height: 46px;"></div></div></div></div><div class="text_cell_render rendered_html" tabindex="-1"><h1 id="Feature-Selection">Feature Selection<a class="anchor-link" href="https://main-dot-datalab-dot-datalab-projects-1331.appspot.com/notebooks/Xiaojukeji%20Algorithm%20Competition/(archive)%204.%20Create%20Baseline%20Algorithm.ipynb#Feature-Selection">¶</a></h1>
</div></div></div><div class="cell code_cell unselected rendered" tabindex="2"><div class="input"><div class="prompt input_prompt">In&nbsp;[21]:</div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 6px; left: 6px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-width: 732px; margin-bottom: -17px; border-right-width: 13px; min-height: 201px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 21px;">&nbsp;</div></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-operator">%%</span><span class="cm-variable">sql</span> <span class="cm-operator">--</span><span class="cm-variable">module</span> <span class="cm-variable">q_all</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text="">&#8203;</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">SELECT</span> <span class="cm-operator">*</span>, <span class="cm-variable">HASH</span>(<span class="cm-variable">CAST</span>(<span class="cm-variable">district_id</span> <span class="cm-variable">AS</span> <span class="cm-variable">STRING</span>) <span class="cm-operator">+</span><span class="cm-variable">timeslot</span>) <span class="cm-variable">AS</span> <span class="cm-variable">hash_value</span>,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable">IF</span>(<span class="cm-variable">ABS</span>(<span class="cm-variable">HASH</span>(<span class="cm-variable">CAST</span>(<span class="cm-variable">district_id</span> <span class="cm-variable">AS</span> <span class="cm-variable">STRING</span>) <span class="cm-operator">+</span> <span class="cm-variable">timeslot</span>)) <span class="cm-operator">%</span> <span class="cm-number">2</span> <span class="cm-operator">==</span> <span class="cm-number">1</span>, <span class="cm-string">'True'</span>, <span class="cm-string">'False'</span>)</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-variable">AS</span> <span class="cm-variable">included_in_sample</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">FROM</span> [<span class="cm-variable">datalab</span><span class="cm-operator">-</span><span class="cm-variable">projects</span><span class="cm-operator">-</span><span class="cm-number">1331</span>:<span class="cm-variable">xjk_algo_comp</span>.<span class="cm-variable">future_gaps_final2</span>]</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">WHERE</span> <span class="cm-variable">gap</span> <span class="cm-operator">&gt;</span> <span class="cm-number">0</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text="">&#8203;</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment"># The above query randomizes its outputs.</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 13px; width: 1px; top: 201px;"></div><div class="CodeMirror-gutters" style="display: none; height: 214px;"></div></div></div></div></div></div><div class="output_wrapper"><div class="out_prompt_overlay prompt" title="click to expand output; double click to hide output" style="display: none;"></div><div class="output" style="display: none;"></div><div class="btn btn-default output_collapsed" title="click to expand output" style="display: none;">. . .</div></div></div><div class="cell code_cell unselected rendered" tabindex="2"><div class="input"><div class="prompt input_prompt">In&nbsp;[22]:</div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 6px; left: 6px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-width: 489px; margin-bottom: -17px; border-right-width: 13px; min-height: 222px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 21px;">&nbsp;</div></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">query</span> = <span class="cm-variable">bq</span>.<span class="cm-variable">Query</span>(<span class="cm-variable">q_all</span>)</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">tableresult</span> = <span class="cm-variable">query</span>.<span class="cm-variable">results</span>()</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text="">&#8203;</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">all_data</span> = <span class="cm-variable">np</span>.<span class="cm-variable">zeros</span>((<span class="cm-variable">tableresult</span>.<span class="cm-variable">length</span>, <span class="cm-builtin">len</span>(<span class="cm-variable">fields</span>)))</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">print</span> <span class="cm-string">'there are {} rows'</span>.<span class="cm-builtin">format</span>(<span class="cm-variable">tableresult</span>.<span class="cm-variable">length</span>)</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">for</span> <span class="cm-variable">rcounter</span>, <span class="cm-variable">row</span> <span class="cm-keyword">in</span> <span class="cm-builtin">enumerate</span>(<span class="cm-variable">tableresult</span>):</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-keyword cm-error">for</span> <span class="cm-variable">fcounter</span>, <span class="cm-variable">field</span> <span class="cm-keyword">in</span> <span class="cm-builtin">enumerate</span>(<span class="cm-variable">fields</span>):</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-variable">all_data</span>[<span class="cm-variable">rcounter</span>, <span class="cm-variable">fcounter</span>] = <span class="cm-variable">row</span>[<span class="cm-variable">field</span>]</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-keyword cm-error">if</span> <span class="cm-variable">rcounter</span> <span class="cm-operator">%</span> <span class="cm-number">5000</span> <span class="cm-operator">==</span> <span class="cm-number">0</span>:</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-keyword">print</span> <span class="cm-string">'processed {} rows'</span>.<span class="cm-builtin">format</span>(<span class="cm-variable">rcounter</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 13px; width: 1px; top: 222px;"></div><div class="CodeMirror-gutters" style="display: none; height: 235px;"></div></div></div></div></div></div><div class="output_wrapper"><div class="out_prompt_overlay prompt" title="click to expand output; double click to hide output" style="display: block;"></div><div class="output" style=""><div class="output_area"><div class="prompt"></div><div class="output_subarea output_text output_stream output_stdout"><pre>there are 102680 rows
processed 0 rows
processed 5000 rows
processed 10000 rows
processed 15000 rows
processed 20000 rows
processed 25000 rows
processed 30000 rows
processed 35000 rows
processed 40000 rows
processed 45000 rows
processed 50000 rows
processed 55000 rows
processed 60000 rows
processed 65000 rows
processed 70000 rows
processed 75000 rows
processed 80000 rows
processed 85000 rows
processed 90000 rows
processed 95000 rows
processed 100000 rows
</pre></div></div></div><div class="btn btn-default output_collapsed" title="click to expand output" style="display: none;">. . .</div></div></div><div class="cell code_cell unselected rendered" tabindex="2"><div class="input"><div class="prompt input_prompt">In&nbsp;[37]:</div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 6px; left: 6px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-width: 741px; margin-bottom: -17px; border-right-width: 13px; min-height: 117px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 21px;">&nbsp;</div></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment"># Get timeslots to test from GCS</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">item</span> = <span class="cm-variable">storage</span>.<span class="cm-variable">Item</span>(<span class="cm-string">'datalab-projects-1331-datalab'</span>,<span class="cm-string">'data/timeslots_to_test2.txt'</span>)</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">timeslots_to_test</span> = <span class="cm-variable">item</span>.<span class="cm-variable">read_from</span>().<span class="cm-variable">strip</span>().<span class="cm-variable">split</span>(<span class="cm-string">'\n'</span>)</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">tquery</span> = <span class="cm-string">','</span>.<span class="cm-variable">join</span>(<span class="cm-builtin">map</span>(<span class="cm-keyword">lambda</span> <span class="cm-variable">x</span>: <span class="cm-string">"'{}'"</span>.<span class="cm-builtin">format</span>(<span class="cm-variable">x</span>.<span class="cm-variable">strip</span>()), <span class="cm-variable">timeslots_to_test</span>))</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">print</span>(<span class="cm-variable">tquery</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 13px; width: 1px; top: 117px;"></div><div class="CodeMirror-gutters" style="display: none; height: 130px;"></div></div></div></div></div></div><div class="output_wrapper"><div class="out_prompt_overlay prompt" title="click to expand output; double click to hide output" style="display: block;"></div><div class="output" style=""><div class="output_area"><div class="prompt"></div><div class="output_subarea output_text output_stream output_stdout"><pre>'2016-01-23-46','2016-01-23-58','2016-01-23-70','2016-01-23-82','2016-01-23-94','2016-01-23-106','2016-01-23-118','2016-01-23-130','2016-01-23-142','2016-01-25-58','2016-01-25-70','2016-01-25-82','2016-01-25-94','2016-01-25-106','2016-01-25-118','2016-01-25-130','2016-01-25-142','2016-01-27-46','2016-01-27-58','2016-01-27-70','2016-01-27-82','2016-01-27-94','2016-01-27-106','2016-01-27-118','2016-01-27-130','2016-01-27-142','2016-01-29-58','2016-01-29-70','2016-01-29-82','2016-01-29-94','2016-01-29-106','2016-01-29-118','2016-01-29-130','2016-01-29-142','2016-01-31-46','2016-01-31-58','2016-01-31-70','2016-01-31-82','2016-01-31-94','2016-01-31-106','2016-01-31-118','2016-01-31-130','2016-01-31-142'
</pre></div></div></div><div class="btn btn-default output_collapsed" title="click to expand output" style="display: none;">. . .</div></div></div><div class="cell code_cell unselected rendered" tabindex="2"><div class="input"><div class="prompt input_prompt">In&nbsp;[38]:</div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 6px; left: 6px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-width: 921px; margin-bottom: -17px; border-right-width: 13px; min-height: 327px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 21px;">&nbsp;</div></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-operator">%%</span><span class="cm-variable">sql</span> <span class="cm-operator">--</span><span class="cm-variable">module</span> <span class="cm-variable">q_all_t</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text="">&#8203;</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">SELECT</span> <span class="cm-operator">*</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">FROM</span> [<span class="cm-variable">datalab</span><span class="cm-operator">-</span><span class="cm-variable">projects</span><span class="cm-operator">-</span><span class="cm-number">1331</span>:<span class="cm-variable">xjk_algo_comp_test</span>.<span class="cm-variable">future_gaps_final2</span>]</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">WHERE</span> <span class="cm-variable">gap</span> <span class="cm-operator">&gt;</span> <span class="cm-number">0</span> <span class="cm-variable">AND</span> <span class="cm-variable">timeslot</span> <span class="cm-variable">NOT</span> <span class="cm-variable">IN</span> (<span class="cm-string">'2016-01-23-46'</span>,<span class="cm-string">'2016-01-23-58'</span>,<span class="cm-string">'2016-01-23-70'</span>,<span class="cm-string">'2016-01-23-82'</span>,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-string">'2016-01-23-94'</span>,<span class="cm-string">'2016-01-23-106'</span>,<span class="cm-string">'2016-01-23-118'</span>,<span class="cm-string">'2016-01-23-130'</span>,<span class="cm-string">'2016-01-23-142'</span>,<span class="cm-string">'2016-01-25-58'</span>,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-string">'2016-01-25-70'</span>,<span class="cm-string">'2016-01-25-82'</span>,<span class="cm-string">'2016-01-25-94'</span>,<span class="cm-string">'2016-01-25-106'</span>,<span class="cm-string">'2016-01-25-118'</span>,<span class="cm-string">'2016-01-25-130'</span>,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-string">'2016-01-25-142'</span>,<span class="cm-string">'2016-01-27-46'</span>,<span class="cm-string">'2016-01-27-58'</span>,<span class="cm-string">'2016-01-27-70'</span>,<span class="cm-string">'2016-01-27-82'</span>,<span class="cm-string">'2016-01-27-94'</span>,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-string">'2016-01-27-106'</span>,<span class="cm-string">'2016-01-27-118'</span>,<span class="cm-string">'2016-01-27-130'</span>,<span class="cm-string">'2016-01-27-142'</span>,<span class="cm-string">'2016-01-29-58'</span>,<span class="cm-string">'2016-01-29-70'</span>,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-string">'2016-01-29-82'</span>,<span class="cm-string">'2016-01-29-94'</span>,<span class="cm-string">'2016-01-29-106'</span>,<span class="cm-string">'2016-01-29-118'</span>,<span class="cm-string">'2016-01-29-130'</span>,<span class="cm-string">'2016-01-29-142'</span>,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-string">'2016-01-31-46'</span>,<span class="cm-string">'2016-01-31-58'</span>,<span class="cm-string">'2016-01-31-70'</span>,<span class="cm-string">'2016-01-31-82'</span>,<span class="cm-string">'2016-01-31-94'</span>,<span class="cm-string">'2016-01-31-106'</span>,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-string">'2016-01-31-118'</span>,<span class="cm-string">'2016-01-31-130'</span>,<span class="cm-string">'2016-01-31-142'</span>)</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">ORDER</span> <span class="cm-variable">BY</span> <span class="cm-variable">timeslot</span>, <span class="cm-variable">district_id</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text="">&#8203;</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment"># Test dataset - used to check if estimator can generalize well to new data.</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 13px; width: 1px; top: 327px;"></div><div class="CodeMirror-gutters" style="display: none; height: 340px;"></div></div></div></div></div></div><div class="output_wrapper"><div class="out_prompt_overlay prompt" title="click to expand output; double click to hide output" style="display: none;"></div><div class="output" style="display: none;"></div><div class="btn btn-default output_collapsed" title="click to expand output" style="display: none;">. . .</div></div></div><div class="cell code_cell unselected rendered" tabindex="2"><div class="input"><div class="prompt input_prompt">In&nbsp;[39]:</div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 6px; left: 6px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-width: 525px; margin-bottom: -17px; border-right-width: 13px; min-height: 222px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 21px;">&nbsp;</div></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">query_t</span> = <span class="cm-variable">bq</span>.<span class="cm-variable">Query</span>(<span class="cm-variable">q_all_t</span>)</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">tableresult_t</span> = <span class="cm-variable">query_t</span>.<span class="cm-variable">results</span>()</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text="">&#8203;</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">all_data_t</span> = <span class="cm-variable">np</span>.<span class="cm-variable">zeros</span>((<span class="cm-variable">tableresult_t</span>.<span class="cm-variable">length</span>, <span class="cm-builtin">len</span>(<span class="cm-variable">fields</span>)))</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">print</span> <span class="cm-string">'there are {} rows'</span>.<span class="cm-builtin">format</span>(<span class="cm-variable">tableresult_t</span>.<span class="cm-variable">length</span>)</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">for</span> <span class="cm-variable">rcounter</span>, <span class="cm-variable">row</span> <span class="cm-keyword">in</span> <span class="cm-builtin">enumerate</span>(<span class="cm-variable">tableresult_t</span>):</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-keyword cm-error">for</span> <span class="cm-variable">fcounter</span>, <span class="cm-variable">field</span> <span class="cm-keyword">in</span> <span class="cm-builtin">enumerate</span>(<span class="cm-variable">fields</span>):</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-variable">all_data_t</span>[<span class="cm-variable">rcounter</span>, <span class="cm-variable">fcounter</span>] = <span class="cm-variable">row</span>[<span class="cm-variable">field</span>]</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-keyword cm-error">if</span> <span class="cm-variable">rcounter</span> <span class="cm-operator">%</span> <span class="cm-number">1000</span> <span class="cm-operator">==</span> <span class="cm-number">0</span>:</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-keyword">print</span> <span class="cm-string">'processed {} rows'</span>.<span class="cm-builtin">format</span>(<span class="cm-variable">rcounter</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 13px; width: 1px; top: 222px;"></div><div class="CodeMirror-gutters" style="display: none; height: 235px;"></div></div></div></div></div></div><div class="output_wrapper"><div class="out_prompt_overlay prompt" title="click to expand output; double click to hide output" style="display: block;"></div><div class="output" style=""><div class="output_area"><div class="prompt"></div><div class="output_subarea output_text output_stream output_stdout"><pre>there are 5311 rows
processed 0 rows
processed 1000 rows
processed 2000 rows
processed 3000 rows
processed 4000 rows
processed 5000 rows
</pre></div></div></div><div class="btn btn-default output_collapsed" title="click to expand output" style="display: none;">. . .</div></div></div><div class="cell text_cell unselected rendered" tabindex="2"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area"><div class="CodeMirror cm-s-default CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 6px; left: 6px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; padding-right: 0px; padding-bottom: 0px; margin-bottom: -17px; border-right-width: 13px; min-height: 33px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 21px;">&nbsp;</div></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-header cm-header-1"># Building and Testing Algorithm(s)</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 13px; width: 1px; top: 33px;"></div><div class="CodeMirror-gutters" style="display: none; height: 46px;"></div></div></div></div><div class="text_cell_render rendered_html" tabindex="-1"><h1 id="Building-and-Testing-Algorithm(s)">Building and Testing Algorithm(s)<a class="anchor-link" href="https://main-dot-datalab-dot-datalab-projects-1331.appspot.com/notebooks/Xiaojukeji%20Algorithm%20Competition/(archive)%204.%20Create%20Baseline%20Algorithm.ipynb#Building-and-Testing-Algorithm(s)">¶</a></h1>
</div></div></div><div class="cell code_cell unselected rendered" tabindex="2"><div class="input"><div class="prompt input_prompt">In&nbsp;[40]:</div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 6px; left: 6px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-width: 741px; margin-bottom: -17px; border-right-width: 13px; min-height: 159px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 21px;">&nbsp;</div></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment"># Useful code to check NaN and Inf values. This is needed since these values would</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment"># cause "Input contains NaN, infinity or a value too large for dtype('float32')</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment"># errors when left unchecked.</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">print</span> <span class="cm-string">"Checkinf for NaN and Inf"</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">print</span> <span class="cm-string">"np.nan="</span>, <span class="cm-variable">np</span>.<span class="cm-variable">where</span>(<span class="cm-variable">np</span>.<span class="cm-variable">isnan</span>(<span class="cm-variable">all_data</span>))</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">print</span> <span class="cm-string">"is.inf="</span>, <span class="cm-variable">np</span>.<span class="cm-variable">where</span>(<span class="cm-variable">np</span>.<span class="cm-variable">isinf</span>(<span class="cm-variable">all_data</span>))</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">print</span> <span class="cm-string">"np.max="</span>, <span class="cm-variable">np</span>.<span class="cm-builtin">max</span>(<span class="cm-builtin">abs</span>(<span class="cm-variable">all_data</span>))</span></pre></div></div></div></div></div><div style="position: absolute; height: 13px; width: 1px; top: 159px;"></div><div class="CodeMirror-gutters" style="display: none; height: 172px;"></div></div></div></div></div></div><div class="output_wrapper"><div class="out_prompt_overlay prompt" title="click to expand output; double click to hide output" style="display: block;"></div><div class="output" style=""><div class="output_area"><div class="prompt"></div><div class="output_subarea output_text output_stream output_stdout"><pre>Checkinf for NaN and Inf
np.nan= (array([], dtype=int64), array([], dtype=int64))
is.inf= (array([], dtype=int64), array([], dtype=int64))
np.max= 708222.866131
</pre></div></div></div><div class="btn btn-default output_collapsed" title="click to expand output" style="display: none;">. . .</div></div></div><div class="cell code_cell unselected rendered" tabindex="2"><div class="input"><div class="prompt input_prompt">In&nbsp;[41]:</div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 6px; left: 6px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-width: 327px; margin-bottom: -17px; border-right-width: 13px; min-height: 54px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 21px;">&nbsp;</div></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">all_data</span>[<span class="cm-variable">np</span>.<span class="cm-variable">isnan</span>(<span class="cm-variable">all_data</span>)] = <span class="cm-number">0</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">all_data_t</span>[<span class="cm-variable">np</span>.<span class="cm-variable">isnan</span>(<span class="cm-variable">all_data_t</span>)] = <span class="cm-number">0</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 13px; width: 1px; top: 54px;"></div><div class="CodeMirror-gutters" style="display: none; height: 67px;"></div></div></div></div></div></div><div class="output_wrapper"><div class="out_prompt_overlay prompt" title="click to expand output; double click to hide output" style="display: none;"></div><div class="output" style="display: none;"></div><div class="btn btn-default output_collapsed" title="click to expand output" style="display: none;">. . .</div></div></div><div class="cell code_cell unselected rendered" tabindex="2"><div class="input"><div class="prompt input_prompt">In&nbsp;[42]:</div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 6px; left: 6px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-width: 741px; margin-bottom: -17px; border-right-width: 13px; min-height: 159px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 21px;">&nbsp;</div></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment"># Useful code to check NaN and Inf values. This is needed since these values would</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment"># cause "Input contains NaN, infinity or a value too large for dtype('float32')</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment"># errors when left unchecked.</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">print</span> <span class="cm-string">"Checkinf for NaN and Inf"</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">print</span> <span class="cm-string">"np.nan="</span>, <span class="cm-variable">np</span>.<span class="cm-variable">where</span>(<span class="cm-variable">np</span>.<span class="cm-variable">isnan</span>(<span class="cm-variable">all_data</span>))</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">print</span> <span class="cm-string">"is.inf="</span>, <span class="cm-variable">np</span>.<span class="cm-variable">where</span>(<span class="cm-variable">np</span>.<span class="cm-variable">isinf</span>(<span class="cm-variable">all_data</span>))</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">print</span> <span class="cm-string">"np.max="</span>, <span class="cm-variable">np</span>.<span class="cm-builtin">max</span>(<span class="cm-builtin">abs</span>(<span class="cm-variable">all_data</span>))</span></pre></div></div></div></div></div><div style="position: absolute; height: 13px; width: 1px; top: 159px;"></div><div class="CodeMirror-gutters" style="display: none; height: 172px;"></div></div></div></div></div></div><div class="output_wrapper"><div class="out_prompt_overlay prompt" title="click to expand output; double click to hide output" style="display: block;"></div><div class="output" style=""><div class="output_area"><div class="prompt"></div><div class="output_subarea output_text output_stream output_stdout"><pre>Checkinf for NaN and Inf
np.nan= (array([], dtype=int64), array([], dtype=int64))
is.inf= (array([], dtype=int64), array([], dtype=int64))
np.max= 708222.866131
</pre></div></div></div><div class="btn btn-default output_collapsed" title="click to expand output" style="display: none;">. . .</div></div></div><div class="cell code_cell unselected rendered" tabindex="2"><div class="input"><div class="prompt input_prompt">In&nbsp;[&nbsp;]:</div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 6px; left: 6px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-width: 777px; margin-bottom: -17px; border-right-width: 13px; min-height: 1167px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 21px;">&nbsp;</div></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">sklearn</span>.<span class="cm-variable">feature_selection</span> <span class="cm-keyword">import</span> <span class="cm-variable">SelectKBest</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">sklearn</span>.<span class="cm-variable">feature_selection</span> <span class="cm-keyword">import</span> <span class="cm-variable">f_classif</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment"># from sklearn.ensemble import RandomForestRegressor</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">sklearn</span>.<span class="cm-variable">ensemble</span> <span class="cm-keyword">import</span> <span class="cm-variable">AdaBoostRegressor</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">sklearn</span>.<span class="cm-variable">preprocessing</span> <span class="cm-keyword">import</span> <span class="cm-variable">Imputer</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">sklearn</span>.<span class="cm-variable">grid_search</span> <span class="cm-keyword">import</span> <span class="cm-variable">RandomizedSearchCV</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">sklearn</span>.<span class="cm-variable">grid_search</span> <span class="cm-keyword">import</span> <span class="cm-variable">GridSearchCV</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text="">&#8203;</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text="">&#8203;</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">steps</span> = [</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment">#   ('impute', Imputer(0)),</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment">#   ('feature_selection', SelectKBest(f_classif)),</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  (<span class="cm-string">'estimate'</span>, <span class="cm-variable">AdaBoostRegressor</span>())</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">]</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text="">&#8203;</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">est</span> = <span class="cm-variable">Pipeline</span>(<span class="cm-variable">steps</span>)</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text="">&#8203;</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">data_train</span> = <span class="cm-variable">all_data</span>[:,<span class="cm-number">1</span>:]</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">targets_train</span> = <span class="cm-variable">all_data</span>[:,<span class="cm-number">0</span>]</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">data_test</span> = <span class="cm-variable">all_data_t</span>[:,<span class="cm-number">1</span>:]</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">targets_test</span> = <span class="cm-variable">all_data_t</span>[:,<span class="cm-number">0</span>]</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text="">&#8203;</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">params</span> = {</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment">#   "feature_selection__k": [i for i in range(1, len(features) - 1)]</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment">#   'estimate__max_features': [i for i in range(1, len(features))],</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment">#   'estimate__n_estimators': [5, 10, 15, 20, 30]</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-string">'estimate__learning_rate'</span>: [<span class="cm-number">0.1</span>, <span class="cm-number">0.3</span>, <span class="cm-number">0.7</span>, <span class="cm-number">1</span>, <span class="cm-number">3</span>, <span class="cm-number">5</span>, <span class="cm-number">10</span>],</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-string">'estimate__n_estimators'</span>: [<span class="cm-number">5</span>, <span class="cm-number">10</span>, <span class="cm-number">20</span>, <span class="cm-number">50</span>, <span class="cm-number">60</span>, <span class="cm-number">80</span>],</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-string">'estimate__loss'</span>: [<span class="cm-string">'linear'</span>, <span class="cm-string">'square'</span>, <span class="cm-string">'exponential'</span>]</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment"># cross_validation_iter = StratifiedShuffleSplit(y=targets_train, test_size=0.3,</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment">#                                                random_state=RANDOM_STATE, n_iter=10)</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment"># search_params = RandomizedSearchCV(</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment">#   estimator=est,</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment">#   param_distributions=params,</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment">#   cv=5,</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment">#   scoring=mape_scorer,</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment">#   n_jobs=2,</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment">#   verbose=1</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment"># )</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text="">&#8203;</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">search_params</span> = <span class="cm-variable">GridSearchCV</span>(</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable">estimator</span>=<span class="cm-variable">est</span>,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable">param_grid</span>=<span class="cm-variable">params</span>,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable">cv</span>=<span class="cm-number">5</span>,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable">scoring</span>=<span class="cm-variable">mape_scorer</span>,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable">n_jobs</span>=<span class="cm-number">2</span>,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable">verbose</span>=<span class="cm-number">1</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">)</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text="">&#8203;</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">search_params</span>.<span class="cm-variable">fit</span>(<span class="cm-variable">data_train</span>, <span class="cm-variable">targets_train</span>)</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">print</span>(<span class="cm-variable">search_params</span>.<span class="cm-variable">grid_scores_</span>)</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">print</span>(<span class="cm-variable">search_params</span>.<span class="cm-variable">best_params_</span>)</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">print</span>(<span class="cm-variable">search_params</span>.<span class="cm-variable">best_score_</span>)</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">search_params</span>.<span class="cm-variable">best_estimator_</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 13px; width: 1px; top: 1167px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1180px;"></div></div></div></div></div></div><div class="output_wrapper"><div class="out_prompt_overlay prompt" title="click to expand output; double click to hide output" style="display: block;"></div><div class="output" style=""><div class="output_area"><div class="prompt"></div><div class="output_subarea output_text output_stream output_stdout"><pre>Fitting 5 folds for each of 126 candidates, totalling 630 fits
</pre></div></div><div class="output_area"><div class="prompt"></div><div class="output_subarea output_text output_stream output_stderr"><pre>[Parallel(n_jobs=2)]: Done   1 jobs       | elapsed:    4.7s
</pre></div></div></div><div class="btn btn-default output_collapsed" title="click to expand output" style="display: none;">. . .</div></div></div><div class="cell text_cell unselected rendered" tabindex="2"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area"><div class="CodeMirror cm-s-default CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 6px; left: 6px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; padding-right: 0px; padding-bottom: 0px; margin-bottom: -17px; border-right-width: 13px; min-height: 33px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 21px;">&nbsp;</div></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">Test data's prediction MAPE score:</span></pre></div></div></div></div></div><div style="position: absolute; height: 13px; width: 1px; top: 33px;"></div><div class="CodeMirror-gutters" style="display: none; height: 46px;"></div></div></div></div><div class="text_cell_render rendered_html" tabindex="-1"><p>Test data's prediction MAPE score:</p>
</div></div></div><div class="cell code_cell unselected rendered" tabindex="2"><div class="input"><div class="prompt input_prompt">In&nbsp;[51]:</div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 6px; left: 6px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-width: 489px; margin-bottom: -17px; border-right-width: 13px; min-height: 75px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 21px;">&nbsp;</div></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">final_est</span> = <span class="cm-variable">search_params</span>.<span class="cm-variable">best_estimator_</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">test_predictions</span> = <span class="cm-variable">final_est</span>.<span class="cm-variable">predict</span>(<span class="cm-variable">data_test</span>)</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">print</span>(<span class="cm-variable">mape</span>(<span class="cm-variable">data_test</span>, <span class="cm-variable">test_predictions</span>, <span class="cm-variable">targets_test</span>))</span></pre></div></div></div></div></div><div style="position: absolute; height: 13px; width: 1px; top: 75px;"></div><div class="CodeMirror-gutters" style="display: none; height: 88px;"></div></div></div></div></div></div><div class="output_wrapper"><div class="out_prompt_overlay prompt" title="click to expand output; double click to hide output" style="display: block;"></div><div class="output" style=""><div class="output_area"><div class="prompt"></div><div class="output_subarea output_text output_stream output_stdout"><pre>1.0613106421
</pre></div></div></div><div class="btn btn-default output_collapsed" title="click to expand output" style="display: none;">. . .</div></div></div><div class="cell code_cell unselected rendered" tabindex="2"><div class="input"><div class="prompt input_prompt">In&nbsp;[52]:</div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 6px; left: 6px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-width: 498px; margin-bottom: -17px; border-right-width: 13px; min-height: 33px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 21px;">&nbsp;</div></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">pickle</span>.<span class="cm-variable">dump</span>(<span class="cm-variable">final_est</span>, <span class="cm-builtin">open</span>(<span class="cm-variable">EST_PICKLE_FILENAME</span>, <span class="cm-string">"w"</span>) )</span></pre></div></div></div></div></div><div style="position: absolute; height: 13px; width: 1px; top: 33px;"></div><div class="CodeMirror-gutters" style="display: none; height: 46px;"></div></div></div></div></div></div><div class="output_wrapper"><div class="out_prompt_overlay prompt" title="click to expand output; double click to hide output" style="display: none;"></div><div class="output" style="display: none;"></div><div class="btn btn-default output_collapsed" title="click to expand output" style="display: none;">. . .</div></div></div><div class="cell text_cell unselected rendered" tabindex="2"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area"><div class="CodeMirror cm-s-default CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 6px; left: 6px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; padding-right: 0px; padding-bottom: 0px; margin-bottom: -17px; border-right-width: 13px; min-height: 54px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 21px;">&nbsp;</div></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">Run "Process Final Test Data With Final Algorithm" to use pickled final algorithm against final test data to produce csv required by this competition.</span></pre></div></div></div></div></div><div style="position: absolute; height: 13px; width: 1px; top: 54px;"></div><div class="CodeMirror-gutters" style="display: none; height: 67px;"></div></div></div></div><div class="text_cell_render rendered_html" tabindex="-1"><p>Run "Process Final Test Data With Final Algorithm" to use pickled final algorithm against final test data to produce csv required by this competition.</p>
</div></div></div><div class="cell code_cell unselected rendered" tabindex="2"><div class="input"><div class="prompt input_prompt">In&nbsp;[&nbsp;]:</div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 6px; left: 6px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-width: 822px; margin-bottom: -17px; border-right-width: 13px; min-height: 369px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 21px;">&nbsp;</div></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">sklearn</span>.<span class="cm-variable">tree</span> <span class="cm-keyword">import</span> <span class="cm-variable">DecisionTreeRegressor</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment"># Just testing Imputer. Turns out somehow Imputer causes number of features reduced, weird.</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text="">&#8203;</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment"># imputer = Imputer()</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">est</span> = <span class="cm-variable">DecisionTreeRegressor</span>(<span class="cm-variable">max_features</span>=<span class="cm-builtin">len</span>(<span class="cm-variable">features</span>))</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text="">&#8203;</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">data_train_i</span> = <span class="cm-variable">np</span>.<span class="cm-variable">copy</span>(<span class="cm-variable">data_train</span>)</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">print</span>(<span class="cm-variable">data_train</span>.<span class="cm-variable">shape</span>)</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">print</span>(<span class="cm-variable">data_train</span>[<span class="cm-number">0</span>:<span class="cm-number">10</span>])</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment"># data_train_i = imputer.fit_transform(data_train)</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">data_train_i</span>[<span class="cm-variable">np</span>.<span class="cm-variable">isnan</span>(<span class="cm-variable">data_train_i</span>)] = <span class="cm-number">0</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">data_train_i</span>.<span class="cm-variable">astype</span>(<span class="cm-string">'float32'</span>)</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">print</span>(<span class="cm-variable">data_train_i</span>.<span class="cm-variable">shape</span>)</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">print</span>(<span class="cm-variable">data_train_i</span>[<span class="cm-number">0</span>:<span class="cm-number">10</span>])</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">est</span>.<span class="cm-variable">fit</span>(<span class="cm-variable">data_train_i</span>, <span class="cm-variable">targets_train</span>)</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">predictions</span> = <span class="cm-variable">est</span>.<span class="cm-variable">predict</span>(<span class="cm-variable">data_test</span>)</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">print</span>(<span class="cm-variable">mape</span>(<span class="cm-variable">data_test</span>, <span class="cm-variable">predictions</span>, <span class="cm-variable">targets_test</span>))</span></pre></div></div></div></div></div><div style="position: absolute; height: 13px; width: 1px; top: 369px;"></div><div class="CodeMirror-gutters" style="display: none; height: 382px;"></div></div></div></div></div></div><div class="output_wrapper"><div class="out_prompt_overlay prompt" title="click to expand output; double click to hide output" style="display: block;"></div><div class="output" style=""></div><div class="btn btn-default output_collapsed" title="click to expand output" style="display: none;">. . .</div></div></div><div class="cell text_cell unselected rendered" tabindex="2"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area"><div class="CodeMirror cm-s-default CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 6px; left: 6px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; padding-right: 0px; padding-bottom: 0px; margin-bottom: -17px; border-right-width: 13px; min-height: 285px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 21px;">&nbsp;</div></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-header cm-header-1"># Results</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text="">&#8203;</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable-2">- AdaBoostRegressor + no previous_gap: 2.0352</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable-2">- AdaBoostRegressor + with previous_gap: 1.770</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable-2">- AdaBoostRegressor + bare necessities (): 1.610</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable-2">- district_id</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable-2">- sum_price</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable-2">- poi1</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable-2">- traffic_tj_level1</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable-2">- traffic_tj_level2</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable-2">- traffic_tj_level3</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable-2">- traffic_tj_level4</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable-2">- previous_gap</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 13px; width: 1px; top: 285px;"></div><div class="CodeMirror-gutters" style="display: none; height: 298px;"></div></div></div></div><div class="text_cell_render rendered_html" tabindex="-1"><h1 id="Results">Results<a class="anchor-link" href="https://main-dot-datalab-dot-datalab-projects-1331.appspot.com/notebooks/Xiaojukeji%20Algorithm%20Competition/(archive)%204.%20Create%20Baseline%20Algorithm.ipynb#Results">¶</a></h1>
<ul>
<li>AdaBoostRegressor + no previous_gap: 2.0352</li>
<li>AdaBoostRegressor + with previous_gap: 1.770</li>
<li>AdaBoostRegressor + bare necessities (): 1.610<ul>
<li>district_id</li>
<li>sum_price</li>
<li>poi1</li>
<li>traffic_tj_level1</li>
<li>traffic_tj_level2</li>
<li>traffic_tj_level3</li>
<li>traffic_tj_level4</li>
<li>previous_gap</li>
</ul>
</li>
</ul>
</div></div></div></div><div class="end_space"></div></div>
              <div id="tooltip" class="ipython_tooltip" style="display:none"><div class="tooltipbuttons"><a href="https://main-dot-datalab-dot-datalab-projects-1331.appspot.com/notebooks/Xiaojukeji%20Algorithm%20Competition/(archive)%204.%20Create%20Baseline%20Algorithm.ipynb#" role="button" class="ui-button"><span class="ui-icon ui-icon-close">Close</span></a><a href="https://main-dot-datalab-dot-datalab-projects-1331.appspot.com/notebooks/Xiaojukeji%20Algorithm%20Competition/(archive)%204.%20Create%20Baseline%20Algorithm.ipynb#" class="ui-corner-all" role="button" id="expanbutton" title="Grow the tooltip vertically (press shift-tab twice)"><span class="ui-icon ui-icon-plus">Expand</span></a><a href="https://main-dot-datalab-dot-datalab-projects-1331.appspot.com/notebooks/Xiaojukeji%20Algorithm%20Competition/(archive)%204.%20Create%20Baseline%20Algorithm.ipynb#" role="button" class="ui-button" title="show the current docstring in pager (press shift-tab 4 times)"><span class="ui-icon ui-icon-arrowstop-l-n">Open in Pager</span></a><a href="https://main-dot-datalab-dot-datalab-projects-1331.appspot.com/notebooks/Xiaojukeji%20Algorithm%20Competition/(archive)%204.%20Create%20Baseline%20Algorithm.ipynb#" role="button" class="ui-button" title="Tooltip will linger for 10 seconds while you type" style="display: none;"><span class="ui-icon ui-icon-clock">Close</span></a></div><div class="pretooltiparrow"></div><div class="tooltiptext smalltooltip"></div></div>
            </div>
          </div>
        </div>
      </div>
      <div id="sidebarArea">
        <div id="sidebarToolbar">
          <div class="btn-toolbar pull-left">
            <div class="btn-group">
              <button id="toggleSidebarButton" type="button" class="btn" title="Toggle the size of the sidebar">
                <span class="fa fa-chevron-right fa-flip-horizontal"></span>
              </button>
            </div>
            <div class="btn-group">
              <button id="navigationButton" type="button" class="btn">Navigation</button>
              <button id="helpButton" type="button" class="btn active">Help</button>
            </div>
          </div>
        </div>
        <div id="sidebarContent">
          <div id="navigation" style="display: none"></div>
          <div id="help">
            <p><b>Help for Python APIs</b></p>
            <p>
              You can enter <code>class?</code> or <code>member?</code> within a code cell in the
              notebook to get help on a Python API.
            </p>
            <br>
            <p>
              For example, try <code>str?</code> to get help information on the built-in Python
              method to convert a value to its string representation.
            </p>
            <br>
            <p>
              Additional help topics and links are also available from the menu off the Help
              icon on the top of the page.
            </p>
            <br>
            <p><b>Docs and Samples</b></p>
            <p>
              The <a href="https://main-dot-datalab-dot-datalab-projects-1331.appspot.com/notebooks/datalab/Readme.ipynb" target"_blank"="">Cloud Datalab Guide</a> featuring
              documentation and sample notebooks is also a great way to check out how you can use Cloud Datalab.
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script src="./(archive) 4. Create Baseline Algorithm_files/promise.min.js"></script>
  <script src="./(archive) 4. Create Baseline Algorithm_files/socket.io.js"></script>
  <script src="./(archive) 4. Create Baseline Algorithm_files/require.js"></script>
  <script>
    window.mathjax_url = '';
    window.sys_info = {};
    require.config({
      baseUrl: '/static/',
      paths: {
        'auth/js/main': 'auth/js/main.min',
        custom : '/custom',
        nbextensions : '/nbextensions',
        widgets : '/deprecatedwidgets',
        kernelspecs : '/kernelspecs',
        underscore : 'components/underscore/underscore-min',
        backbone : 'components/backbone/backbone-min',
        jquery: 'components/jquery/jquery.min',
        bootstrap: 'components/bootstrap/js/bootstrap.min',
        bootstraptour: 'components/bootstrap-tour/build/js/bootstrap-tour.min',
        jqueryui: 'components/jquery-ui/ui/minified/jquery-ui.min',
        moment: 'components/moment/moment',
        codemirror: 'components/codemirror',
        termjs: 'components/term.js/src/term',
      },
      shim: {
        underscore: {
          exports: '_'
        },
        backbone: {
          deps: ["underscore", "jquery"],
          exports: "Backbone"
        },
        bootstrap: {
          deps: ["jquery"],
          exports: "bootstrap"
        },
        bootstraptour: {
          deps: ["bootstrap"],
          exports: "Tour"
        },
        jqueryui: {
          deps: ["jquery"],
          exports: "$"
        }
      }
    });
    require.config({
       map: {
         '*': {
           'contents': 'services/contents',
         }
       }
     });
     window.datalab = {};
  </script>
  <script src="./(archive) 4. Create Baseline Algorithm_files/main.min.js" charset="utf-8"></script>
  <script src="./(archive) 4. Create Baseline Algorithm_files/api.js" async="true" defer="true"></script>
  <script type="text/fragment" id="cellStatus">
    <div class="status" style="display: none;">
      Running...
      <div class="progress progress-striped active">
        <div class="progress-bar" style="width: 100%"></div>
      </div>
    </div>
  </script>
  <script type="text/fragment" id="shortcutsHelp">
    <p>The notebook has two keyboard modes: Edit mode allows you to type code/text into a cell indicated by a raised cell with a shadow. Command mode allows notebook level actions.</p>
    <br>
    <p><b>Command Mode</b> (<code>Esc</code> to enable)</p>
    <div>
      <div><code>Enter</code>: edit mode</div>
      <div><code>Ctrl/Cmd+S</code>: save notebook</div>
      <div><code>Shift+Enter</code>: run cell, select next</div>
      <div><code>Ctrl+Enter</code>: run cell</div>
      <div><code>y</code>: to code</div>
      <div><code>m</code>: to markdown</div>
      <div><code>Up</code>: select previous cell</div>
      <div><code>Down</code>: select next cell</div>
      <div><code>Ctrl+K</code>: move cell up</div>
      <div><code>Ctrl+J</code>: move cell down</div>
      <div><code>a</code>: insert cell above</div>
      <div><code>b</code>: insert cell below</div>
      <div><code>x</code>: cut cell</div>
      <div><code>c</code>: copy cell</div>
      <div><code>v</code>: paste below</div>
      <div><code>dd</code>: delete cell</div>
      <div><code>z</code>: undo delete cell</div>
    </div>
    <br>
    <p><b>Edit Mode</b> (<code>Enter</code> to enable)</p>
    <div>
      <div><code>Esc</code>: command mode</div>
      <div><code>Ctrl/Cmd+S</code>: save notebook</div>
      <div><code>Shift+Enter</code>: run cell, select next</div>
      <div><code>Tab</code>: code completion or indent</div>
      <div><code>Shift+Tab</code>: quick help</div>
      <div><code>Ctrl/Cmd+]</code>: indent</div>
      <div><code>Ctrl/Cmd+[</code>: dedent</div>
      <div><code>Ctrl/Cmd+a</code>: select all</div>
      <div><code>Ctrl/Cmd+z</code>: undo</div>
      <div><code>Ctrl/Cmd+Shift+z</code>: redo</div>
      <div><code>Ctrl/Cmd+x</code>: cut selected</div>
      <div><code>Ctrl/Cmd+c</code>: copy selected</div>
      <div><code>Ctrl/Cmd+v</code>: paste</div>
    </div>
  </script>
  <script type="text/fragment" id="markdownHelp">
  <b>Markdown Syntax</b><br /><br />
      <b>Headers</b>
<pre># This is a level 1 header.
## This is a level 2 header.
### This is a level 3 header.</pre>
      <b>Emphasis</b>
<pre>*Italic text*
_Also italic_

**Bold text</pre>
      <b>Unordered Lists</b>
<pre>* Item 1
* Item 2
  * Item 2a</pre>
      <b>Ordered Lists</b>
<pre>1. Item 1
2. Item 2
   * Item 2a</pre>
      <b>Links</b>
<pre>http://cloud.google.com - automatic
[Text](url)</pre>
      <b>Images</b>
      <pre>![Alt Text](url)</pre>
      <b>Quoted Text</b>
<pre>&gt; Quoted Line 1
&gt; Quoted Line 2</pre>
      <b>Inline Code</b>
      <pre>Some `code` inline</pre>
      <b>Code Block</b>
<pre>Normal text

    Indented code text</pre>
    </div>
  </script>


</body></html>