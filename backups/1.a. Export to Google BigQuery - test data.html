<!DOCTYPE html>
<!-- saved from url=(0172)https://main-dot-datalab-dot-datalab-projects-1331.appspot.com/notebooks/Xiaojukeji%20Algorithm%20Competition/1.a.%20Export%20to%20Google%20BigQuery%20-%20test%20data.ipynb -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>(Busy) 1.a. Export to Google BigQuery - test data</title>
  <link rel="shortcut icon" type="image/x-icon" href="https://main-dot-datalab-dot-datalab-projects-1331.appspot.com/static/favicon.ico">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="./1.a. Export to Google BigQuery - test data_files/codemirror.css">
  <link rel="stylesheet" href="./1.a. Export to Google BigQuery - test data_files/style.min.css" type="text/css">
  <link rel="stylesheet" href="./1.a. Export to Google BigQuery - test data_files/custom.css" type="text/css">
<script async="" src="./1.a. Export to Google BigQuery - test data_files/analytics.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="services/contents" src="./1.a. Export to Google BigQuery - test data_files/contents.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="custom/custom" src="./1.a. Export to Google BigQuery - test data_files/custom.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="nbextensions/widgets/notebook/js/extension" src="./1.a. Export to Google BigQuery - test data_files/extension.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="codemirror/mode/javascript/javascript" src="./1.a. Export to Google BigQuery - test data_files/javascript.js"></script></head>
<body class="notebook_app command_mode" data-project="" data-base-url="/" data-ws-url="" data-notebook-name="1.a.%20Export%20to%20Google%20BigQuery%20-%20test%20data.ipynb" data-notebook-path="Xiaojukeji%20Algorithm%20Competition/1.a.%20Export%20to%20Google%20BigQuery%20-%20test%20data.ipynb" data-feedback-id="717112" data-analytics-id="UA-54894152-3" data-analytics-path="80b4a88506913127983f29e40c06d8da4f77f15111e00f5d14d2b86c0e7cc8cf" data-analytics-title="notebook" data-project-num="803616047008" data-project-id="datalab-projects-1331" data-version-id="0.5.20160527" data-instance-id="561b5a45-7726-484a-bbc6-1ee1e59337b3" data-instance-name="main" data-user-id="TeguhWPurwanto@gmail.com">
  <div id="app">
    <div id="appBar">
      <span id="logo" class="nav navbar-brand pull-left">
        <a href="https://main-dot-datalab-dot-datalab-projects-1331.appspot.com/tree"><img src="./1.a. Export to Google BigQuery - test data_files/logo.png" alt="Google Cloud DataLab"></a>
      </span>
      <span id="save_widget" class="pull-left save_widget">
        <button class="btn" title="Rename notebook"><span id="notebook_name" class="filename">1.a. Export to Google BigQuery - test data</span></button>
        <span class="autosave_status">(autosaved)</span>
      </span>
      <div class="btn-toolbar pull-right">
        <div class="btn-group">
          <button class="btn" data-toggle="dropdown" title="Help Links">
            <span class="fa fa-question-circle"></span>
          </button>
          <ul class="dropdown-menu dropdown-menu-right">
            <li><a id="keyboardHelpLink" href="https://main-dot-datalab-dot-datalab-projects-1331.appspot.com/notebooks/Xiaojukeji%20Algorithm%20Competition/1.a.%20Export%20to%20Google%20BigQuery%20-%20test%20data.ipynb#">Keyboard Shortcuts</a></li>
            <li><a id="markdownHelpLink" href="https://main-dot-datalab-dot-datalab-projects-1331.appspot.com/notebooks/Xiaojukeji%20Algorithm%20Competition/1.a.%20Export%20to%20Google%20BigQuery%20-%20test%20data.ipynb#">Markdown Syntax</a></li>
            <li class="divider"></li>
            <li><a href="https://cloud.google.com/bigquery/what-is-bigquery" target="_blank"><i class="fa fa-external-link pull-right menu-icon"></i><span>BigQuery&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></a></li>
            <li><a href="https://cloud.google.com/storage/docs/overview" target="_blank"><i class="fa fa-external-link pull-right menu-icon"></i><span>Cloud Storage&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></a></li>
            <li class="divider"></li>
            <li><a href="https://developers.google.com/chart/" target="_blank"><i class="fa fa-external-link pull-right menu-icon"></i><span>Google Charts</span></a></li>
            <li><a href="http://matplotlib.org/contents.html" target="_blank"><i class="fa fa-external-link pull-right menu-icon"></i><span>Matplotlib</span></a></li>
            <li><a href="http://pandas.pydata.org/pandas-docs/stable/" target="_blank"><i class="fa fa-external-link pull-right menu-icon"></i><span>Pandas</span></a></li>
            <li><a href="http://scikit-learn.org/stable/" target="_blank"><i class="fa fa-external-link pull-right menu-icon"></i><span>SciKit-Learn</span></a></li>
          </ul>
        </div>
        <div class="btn-group">
          <button class="btn" data-toggle="dropdown" title="User and Project Information">
            <span class="fa fa-user"></span>
          </button>
          <ul class="dropdown-menu dropdown-menu-right">
            <li><a href="https://main-dot-datalab-dot-datalab-projects-1331.appspot.com/notebooks/Xiaojukeji%20Algorithm%20Competition/1.a.%20Export%20to%20Google%20BigQuery%20-%20test%20data.ipynb#" id="userId">TeguhWPurwanto@gmail.com</a></li>
            <li class="divider"></li>
            <li><a href="https://console.developers.google.com/project/datalab-projects-1331" id="consoleLink" target="_blank">Developer Console</a></li>
            <li><a href="https://console.developers.google.com/project/datalab-projects-1331/appengine/versions?moduleId=datalab" id="instancesLink" target="_blank">Developer Console: Cloud Datalab Instances</a></li>
            <li><a href="https://console.developers.google.com/project/datalab-projects-1331/clouddev/develop/browse/default/datalab_main" id="repoLink" target="_blank">Developer Console: Git Repository</a></li>
          </ul>
        </div>
        <div class="btn-group">
          <button id="feedbackButton" title="Provide feedback">
            <span class="fa fa-comment"></span>
          </button>
        </div>
        <div class="btn-group">
          <button id="aboutButton" title="About Google Cloud Datalab">
            <span class="fa fa-info-circle"></span>
          </button>
        </div>
      </div>
    </div>
    <div id="appContent">
      <div id="mainArea">
        <div id="mainToolbar">
          <div class="btn-toolbar pull-left">
            <div class="btn-group">
              <button type="button" class="btn" data-toggle="dropdown" title="Notebook commands">
                <span class="fa fa-book"></span> Notebook <span class="caret"></span>
              </button>
              <ul class="dropdown-menu">
                <li id="saveButton"><a href="https://main-dot-datalab-dot-datalab-projects-1331.appspot.com/notebooks/Xiaojukeji%20Algorithm%20Competition/1.a.%20Export%20to%20Google%20BigQuery%20-%20test%20data.ipynb#">Save</a></li>
                <li id="saveCopyButton"><a href="https://main-dot-datalab-dot-datalab-projects-1331.appspot.com/notebooks/Xiaojukeji%20Algorithm%20Competition/1.a.%20Export%20to%20Google%20BigQuery%20-%20test%20data.ipynb#">Save copy</a></li>
                <li id="renameButton"><a href="https://main-dot-datalab-dot-datalab-projects-1331.appspot.com/notebooks/Xiaojukeji%20Algorithm%20Competition/1.a.%20Export%20to%20Google%20BigQuery%20-%20test%20data.ipynb#">Rename...</a></li>
                <li class="divider"></li>
                <li id="downloadButton"><a href="https://main-dot-datalab-dot-datalab-projects-1331.appspot.com/notebooks/Xiaojukeji%20Algorithm%20Competition/1.a.%20Export%20to%20Google%20BigQuery%20-%20test%20data.ipynb#">Download</a></li>
                <li class="divider"></li>
                <li id="convertHTMLButton"><a href="https://main-dot-datalab-dot-datalab-projects-1331.appspot.com/notebooks/Xiaojukeji%20Algorithm%20Competition/1.a.%20Export%20to%20Google%20BigQuery%20-%20test%20data.ipynb#">Convert to HTML</a></li>
                <li id="convertPythonButton"><a href="https://main-dot-datalab-dot-datalab-projects-1331.appspot.com/notebooks/Xiaojukeji%20Algorithm%20Competition/1.a.%20Export%20to%20Google%20BigQuery%20-%20test%20data.ipynb#">Convert to Python</a></li>
              </ul>
            </div>
          </div>
          <div class="btn-toolbar pull-right">
            <div class="btn-group">
              <button id="addCodeCellButton" type="button" class="btn" title="Append a new code cell">
                <span class="fa fa-plus-square"></span> Add Code
              </button>
              <button id="addMarkdownCellButton" type="button" class="btn" title="Append a new markdown cell">
                <span class="fa fa-plus-square"></span> Add Markdown
              </button>
              <button id="deleteCellButton" type="button" class="btn" title="Delete the selected cell">
                <span class="fa fa-minus-square"></span> Delete
              </button>
              <button id="moveCellUpButton" type="button" class="btn" title="Move the selected cell up">
                <span class="fa fa-chevron-up"></span> Move Up
              </button>
              <button id="moveCellDownButton" type="button" class="btn" title="Move the selected cell down">
                <span class="fa fa-chevron-down"></span> Move Down
              </button>
            </div>
            <div class="btn-group">
              <button id="runButton" type="button" class="btn" title="Run the selected cell">
                <span class="fa fa-play"></span> Run
              </button>
              <button type="button" class="btn dropdown-toggle" data-toggle="dropdown">
                <span class="caret"></span>
              </button>
              <ul class="dropdown-menu">
                <li id="runAllButton"><a href="https://main-dot-datalab-dot-datalab-projects-1331.appspot.com/notebooks/Xiaojukeji%20Algorithm%20Competition/1.a.%20Export%20to%20Google%20BigQuery%20-%20test%20data.ipynb#">Run all Cells</a></li>
                <li id="runToButton"><a href="https://main-dot-datalab-dot-datalab-projects-1331.appspot.com/notebooks/Xiaojukeji%20Algorithm%20Competition/1.a.%20Export%20to%20Google%20BigQuery%20-%20test%20data.ipynb#">Run to this Cell</a></li>
                <li id="runFromButton"><a href="https://main-dot-datalab-dot-datalab-projects-1331.appspot.com/notebooks/Xiaojukeji%20Algorithm%20Competition/1.a.%20Export%20to%20Google%20BigQuery%20-%20test%20data.ipynb#">Run from this Cell</a></li>
              </ul>
            </div>
            <div class="btn-group">
              <button id="clearButton" type="button" class="btn" title="Clear outputs of the selected cell">
                <span class="fa fa-minus-square-o"></span> Clear
              </button>
              <button type="button" class="btn dropdown-toggle" data-toggle="dropdown">
                <span class="caret"></span>
              </button>
              <ul class="dropdown-menu">
                <li id="clearAllButton"><a href="https://main-dot-datalab-dot-datalab-projects-1331.appspot.com/notebooks/Xiaojukeji%20Algorithm%20Competition/1.a.%20Export%20to%20Google%20BigQuery%20-%20test%20data.ipynb#">Clear all Cells</a></li>
              </ul>
            </div>
            <div class="btn-group">
              <button id="resetSessionButton" type="button" class="btn" title="Restart the current notebook session">
                <i id="kernel_indicator_icon" class="kernel_busy_icon" title="Kernel Busy"></i> Reset Session
              </button>
            </div>
          </div>
        </div>
        <div id="mainContent" class="container">
          <div id="ipython-main-app">
            <div id="notebook_panel" style="position: relative">
              <div id="notebook" tabindex="-1"><div class="container" id="notebook-container"><div class="cell code_cell rendered selected" tabindex="2"><div class="input"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 6px; left: 40px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 34px; min-width: 408px; margin-bottom: -17px; border-right-width: 13px; min-height: 432px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>20</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 21px;">&nbsp;</div></div><div class="CodeMirror-code"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">cStringIO</span> <span class="cm-keyword">import</span> <span class="cm-variable">StringIO</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">gzip</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">os</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">glob</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">re</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">pdb</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text="">&#8203;</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">8</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">gcp</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">9</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">gcp</span> <span class="cm-keyword">import</span> <span class="cm-variable">storage</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">10</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">gcp</span> <span class="cm-keyword">import</span> <span class="cm-variable">bigquery</span> <span class="cm-keyword">as</span> <span class="cm-variable">bq</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">11</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">pandas</span> <span class="cm-keyword">as</span> <span class="cm-variable">pd</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">12</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text="">&#8203;</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">13</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment"># Import zip file from Google Cloud Storage</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">14</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">project</span> = <span class="cm-variable">gcp</span>.<span class="cm-variable">Context</span>.<span class="cm-variable">default</span>().<span class="cm-variable">project_id</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">15</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">bucket_name</span> = <span class="cm-variable">project</span> <span class="cm-operator">+</span> <span class="cm-string">'-datalab'</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">16</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">bucket_path</span> = <span class="cm-string">'gs://'</span> <span class="cm-operator">+</span> <span class="cm-variable">bucket_name</span> <span class="cm-operator">+</span> <span class="cm-string">'/data'</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">17</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">print</span> <span class="cm-string">'Bucket: '</span> <span class="cm-operator">+</span> <span class="cm-variable">bucket_path</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">18</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">compressed_filename</span> = <span class="cm-string">'citydata'</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">19</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">season_name</span> = <span class="cm-string">'season_2'</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">20</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">subdirectory_name</span> = <span class="cm-string">'test_set_2'</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 13px; width: 1px; top: 432px;"></div><div class="CodeMirror-gutters" style="height: 445px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 33px;"></div></div></div></div></div></div></div><div class="output_wrapper"><div class="out_prompt_overlay prompt" title="click to expand output; double click to hide output" style="display: block;"></div><div class="output" style=""></div><div class="btn btn-default output_collapsed" title="click to expand output" style="display: none;">. . .</div></div></div><div class="cell code_cell unselected rendered" tabindex="2"><div class="input"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 6px; left: 40px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 34px; min-width: 561px; margin-bottom: -17px; border-right-width: 13px; min-height: 201px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>1</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 21px;">&nbsp;</div></div><div class="CodeMirror-code"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">gzip_filename</span> = <span class="cm-string">'{}.tar.gz'</span>.<span class="cm-builtin">format</span>(<span class="cm-variable">compressed_filename</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">tar_filename</span> = <span class="cm-string">'{}.tar'</span>.<span class="cm-builtin">format</span>(<span class="cm-variable">compressed_filename</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">compressed_file</span> = <span class="cm-builtin">None</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">datadir</span> = <span class="cm-variable">season_name</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment"># If data has not been extracted, extract it.</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">if</span> <span class="cm-keyword">not</span> <span class="cm-variable">os</span>.<span class="cm-variable">path</span>.<span class="cm-variable">isdir</span>(<span class="cm-variable">datadir</span>):</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-comment"># If citydata.tar has not been downloaded, download it</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">8</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span> <span class="cm-keyword">not</span> <span class="cm-variable">os</span>.<span class="cm-variable">path</span>.<span class="cm-variable">isfile</span>(<span class="cm-variable">tar_filename</span>):</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">9</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-variable">bucket_object</span> = <span class="cm-string">'{}/{}'</span>.<span class="cm-builtin">format</span>(<span class="cm-variable">bucket_path</span>, <span class="cm-variable">gzip_filename</span>)</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 13px; width: 1px; top: 201px;"></div><div class="CodeMirror-gutters" style="height: 214px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 33px;"></div></div></div></div></div></div></div><div class="output_wrapper"><div class="out_prompt_overlay prompt" title="click to expand output; double click to hide output" style="display: block;"></div><div class="output" style=""></div><div class="btn btn-default output_collapsed" title="click to expand output" style="display: none;">. . .</div></div></div><div class="cell code_cell unselected rendered" tabindex="2"><div class="input"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 6px; left: 40px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 34px; min-width: 588px; margin-bottom: -17px; border-right-width: 13px; min-height: 33px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>1</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 21px;">&nbsp;</div></div><div class="CodeMirror-code"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-operator">%%</span><span class="cm-variable">storage</span> <span class="cm-variable">read</span> <span class="cm-operator">--</span><span class="cm-builtin">object</span> <span class="cm-error">$</span><span class="cm-variable">bucket_object</span> <span class="cm-operator">--</span><span class="cm-variable">variable</span> <span class="cm-variable">compressed_file</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 13px; width: 1px; top: 33px;"></div><div class="CodeMirror-gutters" style="height: 46px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 33px;"></div></div></div></div></div></div></div><div class="output_wrapper"><div class="out_prompt_overlay prompt" title="click to expand output; double click to hide output" style="display: block;"></div><div class="output" style=""></div><div class="btn btn-default output_collapsed" title="click to expand output" style="display: none;">. . .</div></div></div><div class="cell code_cell unselected rendered" tabindex="2"><div class="input"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 6px; left: 40px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 34px; min-width: 561px; margin-bottom: -17px; border-right-width: 13px; min-height: 285px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>1</div></div><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>13</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 21px;">&nbsp;</div></div><div class="CodeMirror-code"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">if</span> <span class="cm-variable">compressed_file</span>:</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable">gzip_file</span> = <span class="cm-variable">gzip</span>.<span class="cm-variable">GzipFile</span>(<span class="cm-variable">fileobj</span>=<span class="cm-variable">StringIO</span>(<span class="cm-variable">compressed_file</span>))</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-keyword">del</span> <span class="cm-variable">compressed_file</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text="">&#8203;</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-keyword">import</span> <span class="cm-variable">shutil</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-keyword">with</span> <span class="cm-builtin">open</span>(<span class="cm-variable">tar_filename</span>, <span class="cm-string">'wb'</span>) <span class="cm-keyword">as</span> <span class="cm-variable">f_out</span>:</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-variable">shutil</span>.<span class="cm-variable">copyfileobj</span>(<span class="cm-variable">gzip_file</span>, <span class="cm-variable">f_out</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">8</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">9</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-keyword">import</span> <span class="cm-variable">tarfile</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">10</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable">tar</span> = <span class="cm-variable">tarfile</span>.<span class="cm-builtin">open</span>(<span class="cm-variable">tar_filename</span>, <span class="cm-string">"r"</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">11</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable">tar</span>.<span class="cm-variable">extractall</span>()</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">12</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable">tar</span>.<span class="cm-variable">close</span>()</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">13</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable">os</span>.<span class="cm-variable">remove</span>(<span class="cm-variable">tar_filename</span>)</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 13px; width: 1px; top: 285px;"></div><div class="CodeMirror-gutters" style="height: 298px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 33px;"></div></div></div></div></div></div></div><div class="output_wrapper"><div class="out_prompt_overlay prompt" title="click to expand output; double click to hide output" style="display: block;"></div><div class="output" style=""></div><div class="btn btn-default output_collapsed" title="click to expand output" style="display: none;">. . .</div></div></div><div class="cell code_cell unselected rendered" tabindex="2"><div class="input"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 6px; left: 40px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 34px; min-width: 759px; margin-bottom: -17px; border-right-width: 13px; min-height: 285px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>1</div></div><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>13</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 21px;">&nbsp;</div></div><div class="CodeMirror-code"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment"># Downloading and extracting the files from cloud storage.</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text="">&#8203;</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">def</span> <span class="cm-def">process_datafile</span>(<span class="cm-variable">localpath</span>, <span class="cm-variable">storagepath</span>, <span class="cm-variable">table</span>, <span class="cm-variable">mode</span>=<span class="cm-string">'create'</span>, <span class="cm-variable">overwrite</span>=<span class="cm-builtin">False</span>):</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-comment"># Upload extracted file into GCS</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable">storagepath_r</span> = <span class="cm-variable">storagepath</span>.<span class="cm-variable">split</span>(<span class="cm-string">'/'</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable">bucketname</span> = <span class="cm-variable">storagepath_r</span>[<span class="cm-number">2</span>]</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable">itempath</span> = <span class="cm-string">'/'</span>.<span class="cm-variable">join</span>(<span class="cm-variable">storagepath_r</span>[<span class="cm-number">3</span>:])</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">8</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable">item</span> = <span class="cm-variable">storage</span>.<span class="cm-variable">Item</span>(<span class="cm-variable">bucketname</span>, <span class="cm-variable">itempath</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">9</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span> <span class="cm-keyword">not</span> <span class="cm-variable">item</span>.<span class="cm-variable">exists</span>() <span class="cm-keyword">or</span> <span class="cm-variable">overwrite</span>:    </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">10</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-keyword">with</span> <span class="cm-builtin">open</span>(<span class="cm-variable">localpath</span>, <span class="cm-string">'rb'</span>) <span class="cm-keyword">as</span> <span class="cm-variable">f</span>:</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">11</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">      <span class="cm-variable">item</span>.<span class="cm-variable">write_to</span>(<span class="cm-variable">f</span>.<span class="cm-variable">read</span>(), <span class="cm-string">'text/plain'</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">12</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-comment"># Load data into Google BigQuery</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">13</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable">table</span>.<span class="cm-variable">load</span>(<span class="cm-variable">storagepath</span>, <span class="cm-variable">mode</span>=<span class="cm-variable">mode</span>, <span class="cm-variable">csv_options</span>=<span class="cm-variable">bq</span>.<span class="cm-variable">CSVOptions</span>(<span class="cm-variable">delimiter</span>=<span class="cm-string">'\t'</span>))</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 13px; width: 1px; top: 285px;"></div><div class="CodeMirror-gutters" style="height: 298px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 33px;"></div></div></div></div></div></div></div><div class="output_wrapper"><div class="out_prompt_overlay prompt" title="click to expand output; double click to hide output" style="display: none;"></div><div class="output" style="display: none;"></div><div class="btn btn-default output_collapsed" title="click to expand output" style="display: none;">. . .</div></div></div><div class="cell text_cell unselected rendered" tabindex="2"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area"><div class="CodeMirror cm-s-default CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 6px; left: 6px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; padding-right: 0px; padding-bottom: 0px; margin-bottom: -17px; border-right-width: 13px; min-height: 33px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 21px;">&nbsp;</div></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-header cm-header-1"># Process Training Data</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 13px; width: 1px; top: 33px;"></div><div class="CodeMirror-gutters" style="display: none; height: 46px;"></div></div></div></div><div class="text_cell_render rendered_html" tabindex="-1"><h1 id="Process-Training-Data">Process Training Data<a class="anchor-link" href="https://main-dot-datalab-dot-datalab-projects-1331.appspot.com/notebooks/Xiaojukeji%20Algorithm%20Competition/1.a.%20Export%20to%20Google%20BigQuery%20-%20test%20data.ipynb#Process-Training-Data">¶</a></h1>
</div></div></div><div class="cell text_cell unselected rendered" tabindex="2"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area"><div class="CodeMirror cm-s-default CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 6px; left: 6px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; padding-right: 0px; padding-bottom: 0px; margin-bottom: -17px; border-right-width: 13px; min-height: 33px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 21px;">&nbsp;</div></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-header cm-header-2">## Districts</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 13px; width: 1px; top: 33px;"></div><div class="CodeMirror-gutters" style="display: none; height: 46px;"></div></div></div></div><div class="text_cell_render rendered_html" tabindex="-1"><h2 id="Districts">Districts<a class="anchor-link" href="https://main-dot-datalab-dot-datalab-projects-1331.appspot.com/notebooks/Xiaojukeji%20Algorithm%20Competition/1.a.%20Export%20to%20Google%20BigQuery%20-%20test%20data.ipynb#Districts">¶</a></h2>
</div></div></div><div class="cell code_cell unselected rendered" tabindex="2"><div class="input"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 6px; left: 40px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 34px; min-width: 750px; margin-bottom: -17px; border-right-width: 13px; min-height: 243px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>1</div></div><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>11</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 21px;">&nbsp;</div></div><div class="CodeMirror-code"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">table</span> = <span class="cm-variable">bq</span>.<span class="cm-variable">Table</span>(<span class="cm-string">'datalab-projects-1331:xjk_algo_comp_test.districts_preprocessed'</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">if</span> <span class="cm-keyword">not</span> <span class="cm-variable">table</span>.<span class="cm-variable">exists</span>():</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable">schema</span> = <span class="cm-variable">bq</span>.<span class="cm-variable">Schema</span>([</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">      {<span class="cm-string">'name'</span>: <span class="cm-string">'district_hash'</span>, <span class="cm-string">'type'</span>: <span class="cm-string">'STRING'</span>},</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">      {<span class="cm-string">'name'</span>: <span class="cm-string">'district_id'</span>, <span class="cm-string">'type'</span>: <span class="cm-string">'INTEGER'</span>}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    ])</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable">table</span>.<span class="cm-variable">create</span>(<span class="cm-variable">schema</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">8</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">9</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">localpath</span> = <span class="cm-string">'{}/{}/cluster_map/cluster_map'</span>.<span class="cm-builtin">format</span>(<span class="cm-variable">season_name</span>, <span class="cm-variable">subdirectory_name</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">10</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">storagepath</span> = <span class="cm-variable">os</span>.<span class="cm-variable">path</span>.<span class="cm-variable">join</span>(<span class="cm-variable">bucket_path</span>,<span class="cm-variable">localpath</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">11</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">process_datafile</span>(<span class="cm-variable">localpath</span>, <span class="cm-variable">storagepath</span>, <span class="cm-variable">table</span>, <span class="cm-variable">mode</span>=<span class="cm-string">'append'</span>)</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 13px; width: 1px; top: 243px;"></div><div class="CodeMirror-gutters" style="height: 256px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 33px;"></div></div></div></div></div></div></div><div class="output_wrapper"><div class="out_prompt_overlay prompt" title="click to expand output; double click to hide output" style="display: block;"></div><div class="output" style=""></div><div class="btn btn-default output_collapsed" title="click to expand output" style="display: none;">. . .</div></div></div><div class="cell code_cell unselected rendered" tabindex="2"><div class="input"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 6px; left: 40px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 34px; min-width: 768px; margin-bottom: -17px; border-right-width: 13px; min-height: 96px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>1</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 21px;">&nbsp;</div></div><div class="CodeMirror-code"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-operator">%%</span><span class="cm-variable">bigquery</span> <span class="cm-variable">execute</span> <span class="cm-operator">-</span><span class="cm-variable">t</span> <span class="cm-variable">datalab</span><span class="cm-operator">-</span><span class="cm-variable">projects</span><span class="cm-operator">-</span><span class="cm-number">1331</span>:<span class="cm-variable">xjk_algo_comp_test</span>.<span class="cm-variable">districts</span> <span class="cm-operator">-</span><span class="cm-variable">m</span> <span class="cm-variable">overwrite</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">SELECT</span> <span class="cm-variable">LAST</span>(<span class="cm-variable">district_hash</span>) <span class="cm-variable">AS</span> <span class="cm-variable">district_hash</span>, <span class="cm-variable">district_id</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">FROM</span> [<span class="cm-variable">datalab</span><span class="cm-operator">-</span><span class="cm-variable">projects</span><span class="cm-operator">-</span><span class="cm-number">1331</span>:<span class="cm-variable">xjk_algo_comp_test</span>.<span class="cm-variable">districts_preprocessed</span>]</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">GROUP</span> <span class="cm-variable">BY</span> <span class="cm-variable">district_id</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 13px; width: 1px; top: 96px;"></div><div class="CodeMirror-gutters" style="height: 109px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 33px;"></div></div></div></div></div></div></div><div class="output_wrapper"><div class="out_prompt_overlay prompt" title="click to expand output; double click to hide output" style="display: block;"></div><div class="output" style=""></div><div class="btn btn-default output_collapsed" title="click to expand output" style="display: none;">. . .</div></div></div><div class="cell text_cell unselected rendered" tabindex="2"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area"><div class="CodeMirror cm-s-default CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 6px; left: 6px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; padding-right: 0px; padding-bottom: 0px; margin-bottom: -17px; border-right-width: 13px; min-height: 33px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 21px;">&nbsp;</div></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-header cm-header-2">## Weather</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 13px; width: 1px; top: 33px;"></div><div class="CodeMirror-gutters" style="display: none; height: 46px;"></div></div></div></div><div class="text_cell_render rendered_html" tabindex="-1"><h2 id="Weather">Weather<a class="anchor-link" href="https://main-dot-datalab-dot-datalab-projects-1331.appspot.com/notebooks/Xiaojukeji%20Algorithm%20Competition/1.a.%20Export%20to%20Google%20BigQuery%20-%20test%20data.ipynb#Weather">¶</a></h2>
</div></div></div><div class="cell code_cell unselected rendered" tabindex="2"><div class="input"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 6px; left: 40px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 34px; min-width: 732px; margin-bottom: -17px; border-right-width: 13px; min-height: 327px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>1</div></div><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>15</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 21px;">&nbsp;</div></div><div class="CodeMirror-code"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">table</span> = <span class="cm-variable">bq</span>.<span class="cm-variable">Table</span>(<span class="cm-string">'datalab-projects-1331:xjk_algo_comp_test.weather_preprocessed'</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">if</span> <span class="cm-keyword">not</span> <span class="cm-variable">table</span>.<span class="cm-variable">exists</span>():</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable">schema</span> = <span class="cm-variable">bq</span>.<span class="cm-variable">Schema</span>([</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">      {<span class="cm-string">'name'</span>: <span class="cm-string">'time'</span>, <span class="cm-string">'type'</span>: <span class="cm-string">'STRING'</span>},</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">      {<span class="cm-string">'name'</span>: <span class="cm-string">'weather'</span>, <span class="cm-string">'type'</span>: <span class="cm-string">'INTEGER'</span>},</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">      {<span class="cm-string">'name'</span>: <span class="cm-string">'temperature'</span>, <span class="cm-string">'type'</span>: <span class="cm-string">'FLOAT'</span>},</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">      {<span class="cm-string">'name'</span>: <span class="cm-string">'pm25'</span>, <span class="cm-string">'type'</span>: <span class="cm-string">'FLOAT'</span>}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">8</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    ])</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">9</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable">table</span>.<span class="cm-variable">create</span>(<span class="cm-variable">schema</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">10</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">11</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">wildpath</span> = <span class="cm-string">'{}/{}/weather_data/*'</span>.<span class="cm-builtin">format</span>(<span class="cm-variable">season_name</span>, <span class="cm-variable">subdirectory_name</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">12</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">for</span> <span class="cm-variable">localpath</span> <span class="cm-keyword">in</span> <span class="cm-variable">glob</span>.<span class="cm-variable">glob</span>(<span class="cm-variable">wildpath</span>):</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">13</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-keyword">print</span> <span class="cm-string">'process {}'</span>.<span class="cm-builtin">format</span>(<span class="cm-variable">storagepath</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">14</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable">storagepath</span> = <span class="cm-variable">os</span>.<span class="cm-variable">path</span>.<span class="cm-variable">join</span>(<span class="cm-variable">bucket_path</span>,<span class="cm-variable">localpath</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">15</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable">process_datafile</span>(<span class="cm-variable">localpath</span>, <span class="cm-variable">storagepath</span>, <span class="cm-variable">table</span>, <span class="cm-variable">mode</span>=<span class="cm-string">'append'</span>)</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 13px; width: 1px; top: 327px;"></div><div class="CodeMirror-gutters" style="height: 340px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 33px;"></div></div></div></div></div></div></div><div class="output_wrapper"><div class="out_prompt_overlay prompt" title="click to expand output; double click to hide output" style="display: block;"></div><div class="output" style=""></div><div class="btn btn-default output_collapsed" title="click to expand output" style="display: none;">. . .</div></div></div><div class="cell code_cell unselected rendered" tabindex="2"><div class="input"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 6px; left: 40px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 34px; min-width: 768px; margin-bottom: -17px; border-right-width: 13px; min-height: 621px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>1</div></div><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>29</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 21px;">&nbsp;</div></div><div class="CodeMirror-code"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-magic">%%bigquery udf --module transform_weather_time</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text="">&#8203;</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment">/**</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment"> * Pad with 0 or given string.</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment"> *</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment"> * @param int n Number to add padding to.</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment"> * @param int width Width of number + padding.</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">8</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment"> * @param string z (Optional) Other string to replace '0' as padding.</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">9</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment"> */</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">10</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">function</span> <span class="cm-variable">pad</span>(<span class="cm-def">n</span>, <span class="cm-def">width</span>, <span class="cm-def">z</span>) {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">11</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable-2">z</span> <span class="cm-operator">=</span> <span class="cm-variable-2">z</span> <span class="cm-operator">||</span> <span class="cm-string">'0'</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">12</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable-2">n</span> <span class="cm-operator">=</span> <span class="cm-variable-2">n</span> <span class="cm-operator">+</span> <span class="cm-string">''</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">13</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-keyword">return</span> <span class="cm-variable-2">n</span>.<span class="cm-property">length</span> <span class="cm-operator">&gt;=</span> <span class="cm-variable-2">width</span> <span class="cm-operator">?</span> <span class="cm-variable-2">n</span> : <span class="cm-keyword">new</span> <span class="cm-variable">Array</span>(<span class="cm-variable-2">width</span> <span class="cm-operator">-</span> <span class="cm-variable-2">n</span>.<span class="cm-property">length</span> <span class="cm-operator">+</span> <span class="cm-number">1</span>).<span class="cm-property">join</span>(<span class="cm-variable-2">z</span>) <span class="cm-operator">+</span> <span class="cm-variable-2">n</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">14</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">15</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text="">&#8203;</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">16</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment">/**</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">17</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment"> * Transform timestamps of weather table into timeslots in weather table.</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">18</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment"> *</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">19</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment"> * @param {{time: string, weather: integer, temperature: float, pm25: float}} r</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">20</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment"> * @param function({{time: string, weather: integer, temperature: float, pm25: float,</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">21</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment">                     timeslot: string}}) emitFn</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">22</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment"> */</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">23</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">function</span>(<span class="cm-def">r</span>, <span class="cm-def">emitFn</span>) {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">24</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-keyword">var</span> <span class="cm-def">t</span> <span class="cm-operator">=</span> <span class="cm-variable-2">r</span>.<span class="cm-property">time</span>.<span class="cm-property">split</span>(<span class="cm-string-2">/[ :\-]/</span>);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">25</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-keyword">var</span> <span class="cm-def">slot</span> <span class="cm-operator">=</span> <span class="cm-variable">Math</span>.<span class="cm-property">floor</span>((<span class="cm-variable">parseInt</span>(<span class="cm-variable-2">t</span>[<span class="cm-number">3</span>]) <span class="cm-operator">*</span> <span class="cm-number">60</span> <span class="cm-operator">+</span> <span class="cm-variable">parseInt</span>(<span class="cm-variable-2">t</span>[<span class="cm-number">4</span>])) <span class="cm-operator">/</span> <span class="cm-number">10</span>) <span class="cm-operator">+</span> <span class="cm-number">1</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">26</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable-2">r</span>.<span class="cm-property">timeslot</span> <span class="cm-operator">=</span> <span class="cm-variable-2">t</span>[<span class="cm-number">0</span>] <span class="cm-operator">+</span> <span class="cm-string">'-'</span> <span class="cm-operator">+</span> <span class="cm-variable">pad</span>(<span class="cm-variable-2">t</span>[<span class="cm-number">1</span>], <span class="cm-number">2</span>) <span class="cm-operator">+</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">27</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">               <span class="cm-string">'-'</span> <span class="cm-operator">+</span> <span class="cm-variable">pad</span>(<span class="cm-variable-2">t</span>[<span class="cm-number">2</span>], <span class="cm-number">2</span>) <span class="cm-operator">+</span> <span class="cm-string">'-'</span> <span class="cm-operator">+</span> <span class="cm-variable-2">slot</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">28</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable-2">emitFn</span>(<span class="cm-variable-2">r</span>);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">29</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 13px; width: 1px; top: 621px;"></div><div class="CodeMirror-gutters" style="height: 634px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 33px;"></div></div></div></div></div></div></div><div class="output_wrapper"><div class="out_prompt_overlay prompt" title="click to expand output; double click to hide output" style="display: none;"></div><div class="output" style="display: none;"></div><div class="btn btn-default output_collapsed" title="click to expand output" style="display: none;">. . .</div></div></div><div class="cell code_cell unselected rendered" tabindex="2"><div class="input"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 6px; left: 40px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 34px; min-width: 831px; margin-bottom: -17px; border-right-width: 13px; min-height: 117px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>1</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 21px;">&nbsp;</div></div><div class="CodeMirror-code"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-operator">%%</span><span class="cm-variable">bigquery</span> <span class="cm-variable">execute</span> <span class="cm-operator">-</span><span class="cm-variable">t</span> <span class="cm-variable">datalab</span><span class="cm-operator">-</span><span class="cm-variable">projects</span><span class="cm-operator">-</span><span class="cm-number">1331</span>:<span class="cm-variable">xjk_algo_comp_test</span>.<span class="cm-variable">weather</span> <span class="cm-operator">-</span><span class="cm-variable">m</span> <span class="cm-variable">overwrite</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">SELECT</span> <span class="cm-variable">LAST</span>(<span class="cm-variable">time</span>) <span class="cm-variable">AS</span> <span class="cm-variable">time</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">weather</span>) <span class="cm-variable">AS</span> <span class="cm-variable">weather</span>,</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable">LAST</span>(<span class="cm-variable">temperature</span>) <span class="cm-variable">AS</span> <span class="cm-variable">temperature</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pm25</span>) <span class="cm-variable">AS</span> <span class="cm-variable">pm25</span>, <span class="cm-variable">timeslot</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">FROM</span> <span class="cm-variable">transform_weather_time</span>([<span class="cm-variable">datalab</span><span class="cm-operator">-</span><span class="cm-variable">projects</span><span class="cm-operator">-</span><span class="cm-number">1331</span>:<span class="cm-variable">xjk_algo_comp_test</span>.<span class="cm-variable">weather_preprocessed</span>])</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">GROUP</span> <span class="cm-variable">BY</span> <span class="cm-variable">timeslot</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 13px; width: 1px; top: 117px;"></div><div class="CodeMirror-gutters" style="height: 130px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 33px;"></div></div></div></div></div></div></div><div class="output_wrapper"><div class="out_prompt_overlay prompt" title="click to expand output; double click to hide output" style="display: block;"></div><div class="output" style=""></div><div class="btn btn-default output_collapsed" title="click to expand output" style="display: none;">. . .</div></div></div><div class="cell text_cell unselected rendered" tabindex="2"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area"><div class="CodeMirror cm-s-default CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 6px; left: 6px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; padding-right: 0px; padding-bottom: 0px; margin-bottom: -17px; border-right-width: 13px; min-height: 33px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 21px;">&nbsp;</div></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-header cm-header-2">## Traffic</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 13px; width: 1px; top: 33px;"></div><div class="CodeMirror-gutters" style="display: none; height: 46px;"></div></div></div></div><div class="text_cell_render rendered_html" tabindex="-1"><h2 id="Traffic">Traffic<a class="anchor-link" href="https://main-dot-datalab-dot-datalab-projects-1331.appspot.com/notebooks/Xiaojukeji%20Algorithm%20Competition/1.a.%20Export%20to%20Google%20BigQuery%20-%20test%20data.ipynb#Traffic">¶</a></h2>
</div></div></div><div class="cell code_cell unselected rendered" tabindex="2"><div class="input"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 6px; left: 40px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 34px; min-width: 732px; margin-bottom: -17px; border-right-width: 13px; min-height: 453px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>1</div></div><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>21</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 21px;">&nbsp;</div></div><div class="CodeMirror-code"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">table</span> = <span class="cm-variable">bq</span>.<span class="cm-variable">Table</span>(<span class="cm-string">'datalab-projects-1331:xjk_algo_comp_test.traffic_preprocessed'</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">if</span> <span class="cm-keyword">not</span> <span class="cm-variable">table</span>.<span class="cm-variable">exists</span>():</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable">schema</span> = <span class="cm-variable">bq</span>.<span class="cm-variable">Schema</span>([</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">      {<span class="cm-string">'name'</span>: <span class="cm-string">'district_hash'</span>, <span class="cm-string">'type'</span>: <span class="cm-string">'STRING'</span>},</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">      {<span class="cm-string">'name'</span>: <span class="cm-string">'tj_level1'</span>, <span class="cm-string">'type'</span>: <span class="cm-string">'INTEGER'</span>},</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">      {<span class="cm-string">'name'</span>: <span class="cm-string">'tj_level2'</span>, <span class="cm-string">'type'</span>: <span class="cm-string">'INTEGER'</span>},</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">      {<span class="cm-string">'name'</span>: <span class="cm-string">'tj_level3'</span>, <span class="cm-string">'type'</span>: <span class="cm-string">'INTEGER'</span>},</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">8</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">      {<span class="cm-string">'name'</span>: <span class="cm-string">'tj_level4'</span>, <span class="cm-string">'type'</span>: <span class="cm-string">'INTEGER'</span>},</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">9</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">      {<span class="cm-string">'name'</span>: <span class="cm-string">'tj_time'</span>, <span class="cm-string">'type'</span>: <span class="cm-string">'STRING'</span>}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">10</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    ])</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">11</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable">table</span>.<span class="cm-variable">create</span>(<span class="cm-variable">schema</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">12</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">13</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">wildpath</span> = <span class="cm-string">'{}/{}/traffic_data/*'</span>.<span class="cm-builtin">format</span>(<span class="cm-variable">season_name</span>, <span class="cm-variable">subdirectory_name</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">14</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">for</span> <span class="cm-variable">localpath</span> <span class="cm-keyword">in</span> <span class="cm-variable">glob</span>.<span class="cm-variable">glob</span>(<span class="cm-variable">wildpath</span>):</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">15</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-keyword">with</span> <span class="cm-builtin">open</span>(<span class="cm-variable">localpath</span>, <span class="cm-string">'rb'</span>) <span class="cm-keyword">as</span> <span class="cm-variable">f</span>:</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">16</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-variable">text</span> = <span class="cm-variable">f</span>.<span class="cm-variable">read</span>()</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">17</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-keyword">with</span> <span class="cm-builtin">open</span>(<span class="cm-variable">localpath</span>, <span class="cm-string">'wb'</span>) <span class="cm-keyword">as</span> <span class="cm-variable">f</span>:</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">18</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-variable">f</span>.<span class="cm-variable">write</span>(<span class="cm-variable">re</span>.<span class="cm-variable">sub</span>(<span class="cm-string">r'\b\t[0-9]:\b'</span>, <span class="cm-string">'\t'</span>, <span class="cm-variable">text</span>))</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">19</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable">storagepath</span> = <span class="cm-variable">os</span>.<span class="cm-variable">path</span>.<span class="cm-variable">join</span>(<span class="cm-variable">bucket_path</span>,<span class="cm-variable">localpath</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">20</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-keyword">print</span> <span class="cm-string">'process {}'</span>.<span class="cm-builtin">format</span>(<span class="cm-variable">storagepath</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">21</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable">process_datafile</span>(<span class="cm-variable">localpath</span>, <span class="cm-variable">storagepath</span>, <span class="cm-variable">table</span>, <span class="cm-variable">mode</span>=<span class="cm-string">'append'</span>, <span class="cm-variable">overwrite</span>=<span class="cm-builtin">True</span>)</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 13px; width: 1px; top: 453px;"></div><div class="CodeMirror-gutters" style="height: 466px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 33px;"></div></div></div></div></div></div></div><div class="output_wrapper"><div class="out_prompt_overlay prompt" title="click to expand output; double click to hide output" style="display: block;"></div><div class="output" style=""></div><div class="btn btn-default output_collapsed" title="click to expand output" style="display: none;">. . .</div></div></div><div class="cell code_cell unselected rendered" tabindex="2"><div class="input"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 6px; left: 40px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 17px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true" style="right: 17px; left: 34px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true" style="height: 17px; width: 17px;"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 34px; min-width: 939px; margin-bottom: -17px; border-right-width: 13px; min-height: 642px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>1</div></div><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>30</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 21px;">&nbsp;</div></div><div class="CodeMirror-code"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-magic">%%bigquery udf --module transform_traffic_time</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment">/**</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment"> * Pad with 0 or given string.</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment"> *</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment"> * @param int n Number to add padding to.</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment"> * @param int width Width of number + padding.</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">8</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment"> * @param string z (Optional) Other string to replace '0' as padding.</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">9</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment"> */</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">10</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">function</span> <span class="cm-variable">pad</span>(<span class="cm-def">n</span>, <span class="cm-def">width</span>, <span class="cm-def">z</span>) {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">11</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable-2">z</span> <span class="cm-operator">=</span> <span class="cm-variable-2">z</span> <span class="cm-operator">||</span> <span class="cm-string">'0'</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">12</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable-2">n</span> <span class="cm-operator">=</span> <span class="cm-variable-2">n</span> <span class="cm-operator">+</span> <span class="cm-string">''</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">13</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-keyword">return</span> <span class="cm-variable-2">n</span>.<span class="cm-property">length</span> <span class="cm-operator">&gt;=</span> <span class="cm-variable-2">width</span> <span class="cm-operator">?</span> <span class="cm-variable-2">n</span> : <span class="cm-keyword">new</span> <span class="cm-variable">Array</span>(<span class="cm-variable-2">width</span> <span class="cm-operator">-</span> <span class="cm-variable-2">n</span>.<span class="cm-property">length</span> <span class="cm-operator">+</span> <span class="cm-number">1</span>).<span class="cm-property">join</span>(<span class="cm-variable-2">z</span>) <span class="cm-operator">+</span> <span class="cm-variable-2">n</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">14</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">15</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text="">&#8203;</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">16</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment">/**</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">17</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment"> * Transform timestamps of weather table into timeslots in traffic table.</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">18</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment"> *</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">19</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment"> * @param {{district_hash: string, tj_level1: integer, tj_level2: integer, tj_level3: integer, </span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">20</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment">            tj_level4: integer, tj_time: string}} r</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">21</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment"> * @param function({{district_hash: string, tj_level1: integer, tj_level2: integer, tj_level3: integer, </span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">22</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment">                     tj_level4: integer, tj_time: string, timeslot: string}}) emitFn</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">23</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment"> */</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">24</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">function</span>(<span class="cm-def">r</span>, <span class="cm-def">emitFn</span>) {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">25</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-keyword">var</span> <span class="cm-def">t</span> <span class="cm-operator">=</span> <span class="cm-variable-2">r</span>.<span class="cm-property">tj_time</span>.<span class="cm-property">split</span>(<span class="cm-string-2">/[ :\-]/</span>);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">26</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-keyword">var</span> <span class="cm-def">slot</span> <span class="cm-operator">=</span> <span class="cm-variable">Math</span>.<span class="cm-property">floor</span>((<span class="cm-variable">parseInt</span>(<span class="cm-variable-2">t</span>[<span class="cm-number">3</span>]) <span class="cm-operator">*</span> <span class="cm-number">60</span> <span class="cm-operator">+</span> <span class="cm-variable">parseInt</span>(<span class="cm-variable-2">t</span>[<span class="cm-number">4</span>])) <span class="cm-operator">/</span> <span class="cm-number">10</span>) <span class="cm-operator">+</span> <span class="cm-number">1</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">27</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable-2">r</span>.<span class="cm-property">timeslot</span> <span class="cm-operator">=</span> <span class="cm-variable-2">t</span>[<span class="cm-number">0</span>] <span class="cm-operator">+</span> <span class="cm-string">'-'</span> <span class="cm-operator">+</span> <span class="cm-variable">pad</span>(<span class="cm-variable-2">t</span>[<span class="cm-number">1</span>], <span class="cm-number">2</span>) <span class="cm-operator">+</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">28</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">               <span class="cm-string">'-'</span> <span class="cm-operator">+</span> <span class="cm-variable">pad</span>(<span class="cm-variable-2">t</span>[<span class="cm-number">2</span>], <span class="cm-number">2</span>) <span class="cm-operator">+</span> <span class="cm-string">'-'</span> <span class="cm-operator">+</span> <span class="cm-variable-2">slot</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">29</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable-2">emitFn</span>(<span class="cm-variable-2">r</span>);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">30</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 13px; width: 1px; top: 642px;"></div><div class="CodeMirror-gutters" style="height: 655px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 33px;"></div></div></div></div></div></div></div><div class="output_wrapper"><div class="out_prompt_overlay prompt" title="click to expand output; double click to hide output" style="display: none;"></div><div class="output" style="display: none;"></div><div class="btn btn-default output_collapsed" title="click to expand output" style="display: none;">. . .</div></div></div><div class="cell code_cell unselected rendered" tabindex="2"><div class="input"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 6px; left: 40px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 34px; min-width: 831px; margin-bottom: -17px; border-right-width: 13px; min-height: 159px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>1</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 21px;">&nbsp;</div></div><div class="CodeMirror-code"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-operator">%%</span><span class="cm-variable">bigquery</span> <span class="cm-variable">execute</span> <span class="cm-operator">-</span><span class="cm-variable">t</span> <span class="cm-variable">datalab</span><span class="cm-operator">-</span><span class="cm-variable">projects</span><span class="cm-operator">-</span><span class="cm-number">1331</span>:<span class="cm-variable">xjk_algo_comp_test</span>.<span class="cm-variable">traffic</span> <span class="cm-operator">-</span><span class="cm-variable">m</span> <span class="cm-variable">overwrite</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">SELECT</span> <span class="cm-variable">district_hash</span>, <span class="cm-variable">AVG</span>(<span class="cm-variable">tj_level1</span>) <span class="cm-variable">AS</span> <span class="cm-variable">tj_level1</span>,</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable">AVG</span>(<span class="cm-variable">tj_level2</span>) <span class="cm-variable">AS</span> <span class="cm-variable">tj_level2</span>, <span class="cm-variable">AVG</span>(<span class="cm-variable">tj_level3</span>) <span class="cm-variable">AS</span> <span class="cm-variable">tj_level3</span>, <span class="cm-variable">AVG</span>(<span class="cm-variable">tj_level4</span>) <span class="cm-variable">AS</span> <span class="cm-variable">tj_level4</span>,</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable">LAST</span>(<span class="cm-variable">tj_time</span>) <span class="cm-variable">AS</span> <span class="cm-variable">tj_time</span>, <span class="cm-variable">timeslot</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">FROM</span> <span class="cm-variable">transform_traffic_time</span>([<span class="cm-variable">datalab</span><span class="cm-operator">-</span><span class="cm-variable">projects</span><span class="cm-operator">-</span><span class="cm-number">1331</span>:<span class="cm-variable">xjk_algo_comp_test</span>.<span class="cm-variable">traffic_preprocessed</span>])</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">GROUP</span> <span class="cm-variable">BY</span> <span class="cm-variable">district_hash</span>, <span class="cm-variable">timeslot</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 13px; width: 1px; top: 159px;"></div><div class="CodeMirror-gutters" style="height: 172px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 33px;"></div></div></div></div></div></div></div><div class="output_wrapper"><div class="out_prompt_overlay prompt" title="click to expand output; double click to hide output" style="display: block;"></div><div class="output" style=""></div><div class="btn btn-default output_collapsed" title="click to expand output" style="display: none;">. . .</div></div></div><div class="cell text_cell unselected rendered" tabindex="2"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area"><div class="CodeMirror cm-s-default CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 6px; left: 6px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; padding-right: 0px; padding-bottom: 0px; margin-bottom: -17px; border-right-width: 13px; min-height: 33px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 21px;">&nbsp;</div></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-header cm-header-2">## POIs</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 13px; width: 1px; top: 33px;"></div><div class="CodeMirror-gutters" style="display: none; height: 46px;"></div></div></div></div><div class="text_cell_render rendered_html" tabindex="-1"><h2 id="POIs">POIs<a class="anchor-link" href="https://main-dot-datalab-dot-datalab-projects-1331.appspot.com/notebooks/Xiaojukeji%20Algorithm%20Competition/1.a.%20Export%20to%20Google%20BigQuery%20-%20test%20data.ipynb#POIs">¶</a></h2>
</div></div></div><div class="cell code_cell unselected rendered" tabindex="2"><div class="input"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 6px; left: 40px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 34px; min-width: 885px; margin-bottom: -17px; border-right-width: 13px; min-height: 831px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>1</div></div><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>39</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 21px;">&nbsp;</div></div><div class="CodeMirror-code"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">table</span> = <span class="cm-variable">bq</span>.<span class="cm-variable">Table</span>(<span class="cm-string">'datalab-projects-1331:xjk_algo_comp_test.pois_preprocessed'</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">localpath</span> = <span class="cm-string">'{}/{}/poi_data/poi_data'</span>.<span class="cm-builtin">format</span>(<span class="cm-variable">season_name</span>, <span class="cm-variable">subdirectory_name</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text="">&#8203;</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">pois</span> = []</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">pois_schema</span> = [{<span class="cm-string">'name'</span>: <span class="cm-string">'district_hash'</span>, <span class="cm-string">'type'</span>: <span class="cm-string">'STRING'</span>}]</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">with</span> <span class="cm-builtin">open</span>(<span class="cm-variable">localpath</span>, <span class="cm-string">'rb'</span>) <span class="cm-keyword">as</span> <span class="cm-variable">f</span>:</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">8</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-keyword">for</span> <span class="cm-variable">line</span> <span class="cm-keyword">in</span> <span class="cm-variable">f</span>:</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">9</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-variable">line_pois</span> = <span class="cm-builtin">map</span>(<span class="cm-keyword">lambda</span> <span class="cm-variable">x</span>: [<span class="cm-string">'f{}'</span>.<span class="cm-builtin">format</span>(<span class="cm-variable">x</span>.<span class="cm-variable">split</span>(<span class="cm-string">':'</span>)[<span class="cm-number">0</span>].<span class="cm-variable">replace</span>(<span class="cm-string">'#'</span>, <span class="cm-string">'_'</span>)), <span class="cm-variable">x</span>.<span class="cm-variable">split</span>(<span class="cm-string">':'</span>)[<span class="cm-number">1</span>]],</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">10</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">                    <span class="cm-variable">line</span>.<span class="cm-variable">split</span>(<span class="cm-string">'\t'</span>)[<span class="cm-number">1</span>:])</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">11</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-keyword">for</span> <span class="cm-variable">poi</span> <span class="cm-keyword">in</span> <span class="cm-variable">line_pois</span>:</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">12</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-keyword">if</span> <span class="cm-variable">poi</span>[<span class="cm-number">0</span>] <span class="cm-keyword">not</span> <span class="cm-keyword">in</span> <span class="cm-variable">pois</span>:</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">13</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">      <span class="cm-variable">pois</span>.<span class="cm-variable">append</span>(<span class="cm-variable">poi</span>[<span class="cm-number">0</span>])</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">14</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">      <span class="cm-variable">pois_schema</span>.<span class="cm-variable">append</span>({<span class="cm-string">'name'</span>: <span class="cm-variable">poi</span>[<span class="cm-number">0</span>], <span class="cm-string">'type'</span>: <span class="cm-string">'INTEGER'</span>})</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">15</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">pois</span>.<span class="cm-variable">sort</span>()</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">16</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">pois_schema</span> = <span class="cm-builtin">sorted</span>(<span class="cm-variable">pois_schema</span>, <span class="cm-variable">key</span>=<span class="cm-keyword">lambda</span> <span class="cm-variable">k</span>: <span class="cm-variable">k</span>[<span class="cm-string">'name'</span>]) </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">17</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text="">&#8203;</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">18</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">if</span> <span class="cm-keyword">not</span> <span class="cm-variable">table</span>.<span class="cm-variable">exists</span>():</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">19</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable">schema</span> = <span class="cm-variable">bq</span>.<span class="cm-variable">Schema</span>.<span class="cm-variable">from_data</span>(<span class="cm-variable">pois_schema</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">20</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable">table</span>.<span class="cm-variable">create</span>(<span class="cm-variable">schema</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">21</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">22</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable">pois_data</span> = <span class="cm-variable">pd</span>.<span class="cm-variable">DataFrame</span>(<span class="cm-variable">columns</span>=[<span class="cm-string">'district_hash'</span>] <span class="cm-operator">+</span> <span class="cm-variable">pois</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">23</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-keyword">with</span> <span class="cm-builtin">open</span>(<span class="cm-variable">localpath</span>, <span class="cm-string">'rb'</span>) <span class="cm-keyword">as</span> <span class="cm-variable">f</span>:</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">24</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-keyword">for</span> <span class="cm-variable">line</span> <span class="cm-keyword">in</span> <span class="cm-variable">f</span>:</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">25</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">      <span class="cm-variable">hash_pois</span> = {}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">26</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">      <span class="cm-keyword">for</span> <span class="cm-variable">poi_line</span> <span class="cm-keyword">in</span> <span class="cm-variable">line</span>.<span class="cm-variable">split</span>(<span class="cm-string">'\t'</span>)[<span class="cm-number">1</span>:]:</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">27</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">        <span class="cm-variable">hash_pois</span>[<span class="cm-string">'f{}'</span>.<span class="cm-builtin">format</span>(<span class="cm-variable">poi_line</span>.<span class="cm-variable">split</span>(<span class="cm-string">':'</span>)[<span class="cm-number">0</span>].<span class="cm-variable">replace</span>(<span class="cm-string">'#'</span>, <span class="cm-string">'_'</span>))] = <span class="cm-variable">poi_line</span>.<span class="cm-variable">split</span>(<span class="cm-string">':'</span>)[<span class="cm-number">1</span>]</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">28</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">      <span class="cm-variable">poi_data</span> = [<span class="cm-variable">line</span>.<span class="cm-variable">split</span>(<span class="cm-string">'\t'</span>)[<span class="cm-number">0</span>]]</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">29</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">      <span class="cm-comment"># hash_pois = {f1_1: 15, ...}</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">30</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">      <span class="cm-comment"># pois = ['f1_1', ...]</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">31</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">      <span class="cm-keyword">for</span> <span class="cm-variable">poi</span> <span class="cm-keyword">in</span> <span class="cm-variable">pois</span>:</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">32</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">        <span class="cm-variable">value</span> = <span class="cm-string">'0'</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">33</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">        <span class="cm-keyword">if</span> <span class="cm-variable">poi</span> <span class="cm-keyword">in</span> <span class="cm-variable">hash_pois</span>:</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">34</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">          <span class="cm-variable">value</span> = <span class="cm-variable">hash_pois</span>[<span class="cm-variable">poi</span>].<span class="cm-variable">strip</span>()</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">35</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">        <span class="cm-variable">poi_data</span>.<span class="cm-variable">append</span>(<span class="cm-variable">value</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">36</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">      <span class="cm-variable">pois_data</span>.<span class="cm-variable">loc</span>[<span class="cm-builtin">len</span>(<span class="cm-variable">pois_data</span>)] = <span class="cm-variable">poi_data</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">37</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-keyword">for</span> <span class="cm-variable">poi</span> <span class="cm-keyword">in</span> <span class="cm-variable">pois</span>:</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">38</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-variable">pois_data</span>[<span class="cm-variable">poi</span>] = <span class="cm-variable">pd</span>.<span class="cm-variable">to_numeric</span>(<span class="cm-variable">pois_data</span>[<span class="cm-variable">poi</span>])</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">39</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable">table</span>.<span class="cm-variable">insert_data</span>(<span class="cm-variable">pois_data</span>)</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 13px; width: 1px; top: 831px;"></div><div class="CodeMirror-gutters" style="height: 844px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 33px;"></div></div></div></div></div></div></div><div class="output_wrapper"><div class="out_prompt_overlay prompt" title="click to expand output; double click to hide output" style="display: block;"></div><div class="output" style=""></div><div class="btn btn-default output_collapsed" title="click to expand output" style="display: none;">. . .</div></div></div><div class="cell text_cell unselected rendered" tabindex="2"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area"><div class="CodeMirror cm-s-default CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 6px; left: 6px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; padding-right: 0px; padding-bottom: 0px; margin-bottom: -17px; border-right-width: 13px; min-height: 33px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 21px;">&nbsp;</div></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">Following code can be used to print out feature fields to be used when selecting from tables.</span></pre></div></div></div></div></div><div style="position: absolute; height: 13px; width: 1px; top: 33px;"></div><div class="CodeMirror-gutters" style="display: none; height: 46px;"></div></div></div></div><div class="text_cell_render rendered_html" tabindex="-1"><p>Following code can be used to print out feature fields to be used when selecting from tables.</p>
</div></div></div><div class="cell code_cell unselected rendered" tabindex="2"><div class="input"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 6px; left: 40px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 34px; min-width: 822px; margin-bottom: -17px; border-right-width: 13px; min-height: 138px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>1</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 21px;">&nbsp;</div></div><div class="CodeMirror-code"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">final_text</span> = <span class="cm-string">''</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">for</span> <span class="cm-variable">counter</span>, <span class="cm-variable">poi_text</span> <span class="cm-keyword">in</span> <span class="cm-builtin">enumerate</span>(<span class="cm-builtin">map</span>(<span class="cm-keyword">lambda</span> <span class="cm-variable">x</span>: <span class="cm-string">'LAST(pois.{}) AS {}'</span>.<span class="cm-builtin">format</span>(<span class="cm-variable">x</span>,<span class="cm-variable">x</span>), <span class="cm-variable">pois</span>)):</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span> <span class="cm-variable">counter</span><span class="cm-operator">%</span><span class="cm-number">3</span> <span class="cm-operator">==</span> <span class="cm-number">0</span>:</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-variable">final_text</span> = <span class="cm-string">'{}\n'</span>.<span class="cm-builtin">format</span>(<span class="cm-variable">final_text</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable">final_text</span> = <span class="cm-string">'{}{}, '</span>.<span class="cm-builtin">format</span>(<span class="cm-variable">final_text</span>, <span class="cm-variable">poi_text</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">print</span> <span class="cm-variable">final_text</span>[<span class="cm-number">1</span>:(<span class="cm-builtin">len</span>(<span class="cm-variable">final_text</span>)<span class="cm-operator">-</span><span class="cm-number">2</span>)]</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 13px; width: 1px; top: 138px;"></div><div class="CodeMirror-gutters" style="height: 151px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 33px;"></div></div></div></div></div></div></div><div class="output_wrapper"><div class="out_prompt_overlay prompt" title="click to expand output; double click to hide output" style="display: block;"></div><div class="output" style=""></div><div class="btn btn-default output_collapsed" title="click to expand output" style="display: none;">. . .</div></div></div><div class="cell code_cell unselected rendered" tabindex="2"><div class="input"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 6px; left: 40px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 34px; min-width: 768px; margin-bottom: -17px; border-right-width: 13px; min-height: 1062px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>1</div></div><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>50</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 21px;">&nbsp;</div></div><div class="CodeMirror-code"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-operator">%%</span><span class="cm-variable">bigquery</span> <span class="cm-variable">execute</span> <span class="cm-operator">-</span><span class="cm-variable">t</span> <span class="cm-variable">datalab</span><span class="cm-operator">-</span><span class="cm-variable">projects</span><span class="cm-operator">-</span><span class="cm-number">1331</span>:<span class="cm-variable">xjk_algo_comp_test</span>.<span class="cm-variable">pois</span> <span class="cm-operator">-</span><span class="cm-variable">m</span> <span class="cm-variable">overwrite</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">SELECT</span> <span class="cm-variable">district_hash</span>,</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f1</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f1</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f11</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f11</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f11_1</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f11_1</span>, </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f11_2</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f11_2</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f11_3</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f11_3</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f11_4</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f11_4</span>, </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f11_5</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f11_5</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f11_6</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f11_6</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f11_7</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f11_7</span>, </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f11_8</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f11_8</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f13_4</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f13_4</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f13_8</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f13_8</span>, </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">8</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f14</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f14</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f14_1</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f14_1</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f14_10</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f14_10</span>, </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">9</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f14_2</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f14_2</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f14_3</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f14_3</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f14_6</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f14_6</span>, </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">10</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f14_8</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f14_8</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f15</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f15</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f15_1</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f15_1</span>, </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">11</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f15_2</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f15_2</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f15_3</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f15_3</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f15_4</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f15_4</span>, </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">12</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f15_6</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f15_6</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f15_7</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f15_7</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f15_8</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f15_8</span>, </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">13</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f16</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f16</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f16_1</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f16_1</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f16_10</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f16_10</span>, </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">14</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f16_11</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f16_11</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f16_12</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f16_12</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f16_3</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f16_3</span>, </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">15</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f16_4</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f16_4</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f16_6</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f16_6</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f17</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f17</span>, </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">16</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f17_2</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f17_2</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f17_3</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f17_3</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f17_4</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f17_4</span>, </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">17</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f17_5</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f17_5</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f19</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f19</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f19_1</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f19_1</span>, </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">18</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f19_2</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f19_2</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f19_3</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f19_3</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f19_4</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f19_4</span>, </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">19</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f1_1</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f1_1</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f1_10</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f1_10</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f1_11</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f1_11</span>, </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">20</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f1_2</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f1_2</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f1_3</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f1_3</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f1_4</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f1_4</span>, </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">21</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f1_5</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f1_5</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f1_6</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f1_6</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f1_7</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f1_7</span>, </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">22</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f1_8</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f1_8</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f20</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f20</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f20_1</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f20_1</span>, </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">23</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f20_2</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f20_2</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f20_4</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f20_4</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f20_5</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f20_5</span>, </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">24</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f20_6</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f20_6</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f20_7</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f20_7</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f20_8</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f20_8</span>, </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">25</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f20_9</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f20_9</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f21_1</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f21_1</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f21_2</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f21_2</span>, </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">26</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f22</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f22</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f22_1</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f22_1</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f22_2</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f22_2</span>, </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">27</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f22_3</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f22_3</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f22_4</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f22_4</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f22_5</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f22_5</span>, </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">28</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f23</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f23</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f23_1</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f23_1</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f23_2</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f23_2</span>, </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">29</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f23_3</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f23_3</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f23_4</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f23_4</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f23_5</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f23_5</span>, </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">30</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f23_6</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f23_6</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f24</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f24</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f24_1</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f24_1</span>, </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">31</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f24_2</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f24_2</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f24_3</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f24_3</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f25</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f25</span>, </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">32</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f25_1</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f25_1</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f25_3</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f25_3</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f25_7</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f25_7</span>, </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">33</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f25_8</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f25_8</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f25_9</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f25_9</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f2_1</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f2_1</span>, </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">34</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f2_10</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f2_10</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f2_11</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f2_11</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f2_12</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f2_12</span>, </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">35</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f2_13</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f2_13</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f2_2</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f2_2</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f2_4</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f2_4</span>, </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">36</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f2_5</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f2_5</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f2_6</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f2_6</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f2_7</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f2_7</span>, </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">37</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f2_8</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f2_8</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f3_1</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f3_1</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f3_2</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f3_2</span>, </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">38</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f3_3</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f3_3</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f4</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f4</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f4_1</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f4_1</span>, </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">39</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f4_10</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f4_10</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f4_11</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f4_11</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f4_13</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f4_13</span>, </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">40</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f4_14</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f4_14</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f4_16</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f4_16</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f4_17</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f4_17</span>, </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">41</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f4_18</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f4_18</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f4_2</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f4_2</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f4_3</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f4_3</span>, </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">42</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f4_5</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f4_5</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f4_6</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f4_6</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f4_7</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f4_7</span>, </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">43</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f4_8</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f4_8</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f4_9</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f4_9</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f5</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f5</span>, </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">44</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f5_1</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f5_1</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f5_3</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f5_3</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f5_4</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f5_4</span>, </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">45</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f6</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f6</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f6_1</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f6_1</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f6_2</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f6_2</span>, </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">46</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f6_4</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f6_4</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f7</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f7</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f8</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f8</span>, </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">47</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f8_1</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f8_1</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f8_2</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f8_2</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f8_3</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f8_3</span>, </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">48</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f8_4</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f8_4</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">pois</span>.<span class="cm-variable">f8_5</span>) <span class="cm-variable">AS</span> <span class="cm-variable">f8_5</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">49</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">FROM</span> [<span class="cm-variable">datalab</span><span class="cm-operator">-</span><span class="cm-variable">projects</span><span class="cm-operator">-</span><span class="cm-number">1331</span>:<span class="cm-variable">xjk_algo_comp_test</span>.<span class="cm-variable">pois_preprocessed</span>] <span class="cm-variable">AS</span> <span class="cm-variable">pois</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">50</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">GROUP</span> <span class="cm-variable">BY</span> <span class="cm-variable">district_hash</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 13px; width: 1px; top: 1062px;"></div><div class="CodeMirror-gutters" style="height: 1075px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 33px;"></div></div></div></div></div></div></div><div class="output_wrapper"><div class="out_prompt_overlay prompt" title="click to expand output; double click to hide output" style="display: block;"></div><div class="output" style=""></div><div class="btn btn-default output_collapsed" title="click to expand output" style="display: none;">. . .</div></div></div><div class="cell text_cell unselected rendered" tabindex="2"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area"><div class="CodeMirror cm-s-default CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 6px; left: 6px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; padding-right: 0px; padding-bottom: 0px; margin-bottom: -17px; border-right-width: 13px; min-height: 33px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 21px;">&nbsp;</div></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-header cm-header-2">## Orders</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 13px; width: 1px; top: 33px;"></div><div class="CodeMirror-gutters" style="display: none; height: 46px;"></div></div></div></div><div class="text_cell_render rendered_html" tabindex="-1"><h2 id="Orders">Orders<a class="anchor-link" href="https://main-dot-datalab-dot-datalab-projects-1331.appspot.com/notebooks/Xiaojukeji%20Algorithm%20Competition/1.a.%20Export%20to%20Google%20BigQuery%20-%20test%20data.ipynb#Orders">¶</a></h2>
</div></div></div><div class="cell code_cell unselected rendered" tabindex="2"><div class="input"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 6px; left: 40px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 34px; min-width: 723px; margin-bottom: -17px; border-right-width: 13px; min-height: 348px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>1</div></div><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>16</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 21px;">&nbsp;</div></div><div class="CodeMirror-code"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">table</span> = <span class="cm-variable">bq</span>.<span class="cm-variable">Table</span>(<span class="cm-string">'datalab-projects-1331:xjk_algo_comp_test.orders_preprocessed'</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">if</span> <span class="cm-keyword">not</span> <span class="cm-variable">table</span>.<span class="cm-variable">exists</span>():</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable">schema</span> = <span class="cm-variable">bq</span>.<span class="cm-variable">Schema</span>([{<span class="cm-string">'name'</span>: <span class="cm-string">'order_id'</span>, <span class="cm-string">'type'</span>: <span class="cm-string">'STRING'</span>},</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">                      {<span class="cm-string">'name'</span>: <span class="cm-string">'driver_id'</span>, <span class="cm-string">'type'</span>: <span class="cm-string">'STRING'</span>},</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">                      {<span class="cm-string">'name'</span>: <span class="cm-string">'passenger_id'</span>, <span class="cm-string">'type'</span>: <span class="cm-string">'STRING'</span>},</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">                      {<span class="cm-string">'name'</span>: <span class="cm-string">'start_district_hash'</span>, <span class="cm-string">'type'</span>: <span class="cm-string">'STRING'</span>},</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">                      {<span class="cm-string">'name'</span>: <span class="cm-string">'dest_district_hash'</span>, <span class="cm-string">'type'</span>: <span class="cm-string">'STRING'</span>},</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">8</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">                      {<span class="cm-string">'name'</span>: <span class="cm-string">'price'</span>, <span class="cm-string">'type'</span>: <span class="cm-string">'FLOAT'</span>},</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">9</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">                      {<span class="cm-string">'name'</span>: <span class="cm-string">'time'</span>, <span class="cm-string">'type'</span>: <span class="cm-string">'STRING'</span>}])</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">10</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable">table</span>.<span class="cm-variable">create</span>(<span class="cm-variable">schema</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">11</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">12</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">wildpath</span> = <span class="cm-string">'{}/{}/order_data/*'</span>.<span class="cm-builtin">format</span>(<span class="cm-variable">season_name</span>, <span class="cm-variable">subdirectory_name</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">13</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">for</span> <span class="cm-variable">localpath</span> <span class="cm-keyword">in</span> <span class="cm-variable">glob</span>.<span class="cm-variable">glob</span>(<span class="cm-variable">wildpath</span>):</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">14</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-keyword">print</span> <span class="cm-string">'loading {}'</span>.<span class="cm-builtin">format</span>(<span class="cm-variable">localpath</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">15</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable">storagepath</span> = <span class="cm-variable">os</span>.<span class="cm-variable">path</span>.<span class="cm-variable">join</span>(<span class="cm-variable">bucket_path</span>,<span class="cm-variable">localpath</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">16</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable">process_datafile</span>(<span class="cm-variable">localpath</span>, <span class="cm-variable">storagepath</span>, <span class="cm-variable">table</span>, <span class="cm-variable">mode</span>=<span class="cm-string">'append'</span>)</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 13px; width: 1px; top: 348px;"></div><div class="CodeMirror-gutters" style="height: 361px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 33px;"></div></div></div></div></div></div></div><div class="output_wrapper"><div class="out_prompt_overlay prompt" title="click to expand output; double click to hide output" style="display: block;"></div><div class="output" style=""></div><div class="btn btn-default output_collapsed" title="click to expand output" style="display: none;">. . .</div></div></div><div class="cell code_cell unselected rendered" tabindex="2"><div class="input"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 6px; left: 40px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 34px; min-width: 894px; margin-bottom: -17px; border-right-width: 13px; min-height: 159px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>1</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 21px;">&nbsp;</div></div><div class="CodeMirror-code"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-operator">%%</span><span class="cm-variable">bigquery</span> <span class="cm-variable">execute</span> <span class="cm-operator">-</span><span class="cm-variable">t</span> <span class="cm-variable">datalab</span><span class="cm-operator">-</span><span class="cm-variable">projects</span><span class="cm-operator">-</span><span class="cm-number">1331</span>:<span class="cm-variable">xjk_algo_comp_test</span>.<span class="cm-variable">orders_preprocessed2</span> <span class="cm-operator">-</span><span class="cm-variable">m</span> <span class="cm-variable">overwrite</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text="">&#8203;</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">SELECT</span> <span class="cm-variable">order_id</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">driver_id</span>) <span class="cm-variable">AS</span> <span class="cm-variable">driver_id</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">passenger_id</span>) <span class="cm-variable">AS</span> <span class="cm-variable">passenger_id</span>,</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable">LAST</span>(<span class="cm-variable">start_district_hash</span>) <span class="cm-variable">AS</span> <span class="cm-variable">start_district_hash</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">dest_district_hash</span>) <span class="cm-variable">AS</span> <span class="cm-variable">dest_district_hash</span>,</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable">LAST</span>(<span class="cm-variable">price</span>) <span class="cm-variable">AS</span> <span class="cm-variable">price</span>, <span class="cm-variable">LAST</span>(<span class="cm-variable">time</span>) <span class="cm-variable">AS</span> <span class="cm-variable">time</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">FROM</span> [<span class="cm-variable">datalab</span><span class="cm-operator">-</span><span class="cm-variable">projects</span><span class="cm-operator">-</span><span class="cm-number">1331</span>:<span class="cm-variable">xjk_algo_comp_test</span>.<span class="cm-variable">orders_preprocessed</span>]</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">GROUP</span> <span class="cm-variable">BY</span> <span class="cm-variable">order_id</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 13px; width: 1px; top: 159px;"></div><div class="CodeMirror-gutters" style="height: 172px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 33px;"></div></div></div></div></div></div></div><div class="output_wrapper"><div class="out_prompt_overlay prompt" title="click to expand output; double click to hide output" style="display: block;"></div><div class="output" style=""></div><div class="btn btn-default output_collapsed" title="click to expand output" style="display: none;">. . .</div></div></div><div class="cell code_cell unselected rendered" tabindex="2"><div class="input"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 6px; left: 40px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 34px; min-width: 894px; margin-bottom: -17px; border-right-width: 13px; min-height: 768px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>1</div></div><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>36</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 21px;">&nbsp;</div></div><div class="CodeMirror-code"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-magic">%%bigquery udf --module orders_create_additional_fields</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text="">&#8203;</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment">/**</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment"> * Pad with 0 or given string.</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment"> *</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment"> * @param int n Number to add padding to.</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment"> * @param int width Width of number + padding.</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">8</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment"> * @param string z (Optional) Other string to replace '0' as padding.</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">9</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment"> */</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">10</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">function</span> <span class="cm-variable">pad</span>(<span class="cm-def">n</span>, <span class="cm-def">width</span>, <span class="cm-def">z</span>) {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">11</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable-2">z</span> <span class="cm-operator">=</span> <span class="cm-variable-2">z</span> <span class="cm-operator">||</span> <span class="cm-string">'0'</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">12</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable-2">n</span> <span class="cm-operator">=</span> <span class="cm-variable-2">n</span> <span class="cm-operator">+</span> <span class="cm-string">''</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">13</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-keyword">return</span> <span class="cm-variable-2">n</span>.<span class="cm-property">length</span> <span class="cm-operator">&gt;=</span> <span class="cm-variable-2">width</span> <span class="cm-operator">?</span> <span class="cm-variable-2">n</span> : <span class="cm-keyword">new</span> <span class="cm-variable">Array</span>(<span class="cm-variable-2">width</span> <span class="cm-operator">-</span> <span class="cm-variable-2">n</span>.<span class="cm-property">length</span> <span class="cm-operator">+</span> <span class="cm-number">1</span>).<span class="cm-property">join</span>(<span class="cm-variable-2">z</span>) <span class="cm-operator">+</span> <span class="cm-variable-2">n</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">14</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">15</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text="">&#8203;</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">16</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment">/**</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">17</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment"> * Create additional fields on orders table for gaps table creation.</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">18</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment"> *</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">19</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment"> * @param {{order_id: string, driver_id: string, passenger_id: string,</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">20</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment">            start_district_hash: string, dest_district_hash: string, price: float,</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">21</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment">            time: string}} r</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">22</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment"> * @param function({{order_id: string, driver_id: string, passenger_id: string,</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">23</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment">                     start_district_hash: string, dest_district_hash: string, price: float,</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">24</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment">                     time: string, timeslot: string, timeofday_slot: integer, day_in_week: integer,</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">25</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment">                     date: string}}) emitFn</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">26</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment"> */</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">27</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">function</span>(<span class="cm-def">r</span>, <span class="cm-def">emitFn</span>) {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">28</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-keyword">var</span> <span class="cm-def">t</span> <span class="cm-operator">=</span> <span class="cm-variable-2">r</span>.<span class="cm-property">time</span>.<span class="cm-property">split</span>(<span class="cm-string-2">/[ :\-]/</span>);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">29</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-keyword">var</span> <span class="cm-def">slot</span> <span class="cm-operator">=</span> <span class="cm-variable">Math</span>.<span class="cm-property">floor</span>((<span class="cm-variable">parseInt</span>(<span class="cm-variable-2">t</span>[<span class="cm-number">3</span>]) <span class="cm-operator">*</span> <span class="cm-number">60</span> <span class="cm-operator">+</span> <span class="cm-variable">parseInt</span>(<span class="cm-variable-2">t</span>[<span class="cm-number">4</span>])) <span class="cm-operator">/</span> <span class="cm-number">10</span>) <span class="cm-operator">+</span> <span class="cm-number">1</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">30</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable-2">r</span>.<span class="cm-property">timeslot</span> <span class="cm-operator">=</span> <span class="cm-variable-2">t</span>[<span class="cm-number">0</span>] <span class="cm-operator">+</span> <span class="cm-string">'-'</span> <span class="cm-operator">+</span> <span class="cm-variable">pad</span>(<span class="cm-variable-2">t</span>[<span class="cm-number">1</span>], <span class="cm-number">2</span>) <span class="cm-operator">+</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">31</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">               <span class="cm-string">'-'</span> <span class="cm-operator">+</span> <span class="cm-variable">pad</span>(<span class="cm-variable-2">t</span>[<span class="cm-number">2</span>], <span class="cm-number">2</span>) <span class="cm-operator">+</span> <span class="cm-string">'-'</span> <span class="cm-operator">+</span> <span class="cm-variable-2">slot</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">32</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable-2">r</span>.<span class="cm-property">timeofday_slot</span> <span class="cm-operator">=</span> <span class="cm-variable-2">slot</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">33</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable-2">r</span>.<span class="cm-property">date</span> <span class="cm-operator">=</span> <span class="cm-variable-2">t</span>[<span class="cm-number">0</span>] <span class="cm-operator">+</span> <span class="cm-string">'-'</span> <span class="cm-operator">+</span> <span class="cm-variable">pad</span>(<span class="cm-variable-2">t</span>[<span class="cm-number">1</span>], <span class="cm-number">2</span>) <span class="cm-operator">+</span> <span class="cm-string">'-'</span> <span class="cm-operator">+</span> <span class="cm-variable">pad</span>(<span class="cm-variable-2">t</span>[<span class="cm-number">2</span>], <span class="cm-number">2</span>);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">34</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable-2">r</span>.<span class="cm-property">day_in_week</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-variable">parseInt</span>(<span class="cm-variable-2">t</span>[<span class="cm-number">0</span>]), <span class="cm-variable">parseInt</span>(<span class="cm-variable-2">t</span>[<span class="cm-number">1</span>])<span class="cm-operator">-</span><span class="cm-number">1</span>, <span class="cm-variable">parseInt</span>(<span class="cm-variable-2">t</span>[<span class="cm-number">2</span>])).<span class="cm-property">getDay</span>();</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">35</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable-2">emitFn</span>(<span class="cm-variable-2">r</span>);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">36</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 13px; width: 1px; top: 768px;"></div><div class="CodeMirror-gutters" style="height: 781px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 33px;"></div></div></div></div></div></div></div><div class="output_wrapper"><div class="out_prompt_overlay prompt" title="click to expand output; double click to hide output" style="display: none;"></div><div class="output" style="display: none;"></div><div class="btn btn-default output_collapsed" title="click to expand output" style="display: none;">. . .</div></div></div><div class="cell code_cell unselected rendered" tabindex="2"><div class="input"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 6px; left: 40px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 34px; min-width: 912px; margin-bottom: -17px; border-right-width: 13px; min-height: 117px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>1</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 21px;">&nbsp;</div></div><div class="CodeMirror-code"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-operator">%%</span><span class="cm-variable">bigquery</span> <span class="cm-variable">execute</span> <span class="cm-operator">-</span><span class="cm-variable">t</span> <span class="cm-variable">datalab</span><span class="cm-operator">-</span><span class="cm-variable">projects</span><span class="cm-operator">-</span><span class="cm-number">1331</span>:<span class="cm-variable">xjk_algo_comp_test</span>.<span class="cm-variable">orders</span> <span class="cm-operator">-</span><span class="cm-variable">m</span> <span class="cm-variable">overwrite</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">SELECT</span> <span class="cm-variable">order_id</span>, <span class="cm-variable">driver_id</span>, <span class="cm-variable">passenger_id</span>,</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable">start_district_hash</span>, <span class="cm-variable">dest_district_hash</span>,</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable">price</span>, <span class="cm-variable">time</span>, <span class="cm-variable">timeslot</span>, <span class="cm-variable">timeofday_slot</span>, <span class="cm-variable">day_in_week</span>, <span class="cm-variable">date</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">FROM</span> <span class="cm-variable">orders_create_additional_fields</span>([<span class="cm-variable">datalab</span><span class="cm-operator">-</span><span class="cm-variable">projects</span><span class="cm-operator">-</span><span class="cm-number">1331</span>:<span class="cm-variable">xjk_algo_comp_test</span>.<span class="cm-variable">orders_preprocessed2</span>])</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 13px; width: 1px; top: 117px;"></div><div class="CodeMirror-gutters" style="height: 130px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 33px;"></div></div></div></div></div></div></div><div class="output_wrapper"><div class="out_prompt_overlay prompt" title="click to expand output; double click to hide output" style="display: block;"></div><div class="output" style=""></div><div class="btn btn-default output_collapsed" title="click to expand output" style="display: none;">. . .</div></div></div><div class="cell code_cell unselected rendered" tabindex="2"><div class="input"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 6px; left: 40px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 34px; min-width: 3px; margin-bottom: -17px; border-right-width: 13px; min-height: 33px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>1</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 21px;">&nbsp;</div></div><div class="CodeMirror-code"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -34px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text="">&#8203;</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 13px; width: 1px; top: 33px;"></div><div class="CodeMirror-gutters" style="height: 46px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 33px;"></div></div></div></div></div></div></div><div class="output_wrapper"><div class="out_prompt_overlay prompt" title="click to expand output; double click to hide output" style="display: none;"></div><div class="output" style="display: none;"></div><div class="btn btn-default output_collapsed" title="click to expand output" style="display: none;">. . .</div></div></div></div><div class="end_space"></div></div>
              <div id="tooltip" class="ipython_tooltip" style="display:none"><div class="tooltipbuttons"><a href="https://main-dot-datalab-dot-datalab-projects-1331.appspot.com/notebooks/Xiaojukeji%20Algorithm%20Competition/1.a.%20Export%20to%20Google%20BigQuery%20-%20test%20data.ipynb#" role="button" class="ui-button"><span class="ui-icon ui-icon-close">Close</span></a><a href="https://main-dot-datalab-dot-datalab-projects-1331.appspot.com/notebooks/Xiaojukeji%20Algorithm%20Competition/1.a.%20Export%20to%20Google%20BigQuery%20-%20test%20data.ipynb#" class="ui-corner-all" role="button" id="expanbutton" title="Grow the tooltip vertically (press shift-tab twice)"><span class="ui-icon ui-icon-plus">Expand</span></a><a href="https://main-dot-datalab-dot-datalab-projects-1331.appspot.com/notebooks/Xiaojukeji%20Algorithm%20Competition/1.a.%20Export%20to%20Google%20BigQuery%20-%20test%20data.ipynb#" role="button" class="ui-button" title="show the current docstring in pager (press shift-tab 4 times)"><span class="ui-icon ui-icon-arrowstop-l-n">Open in Pager</span></a><a href="https://main-dot-datalab-dot-datalab-projects-1331.appspot.com/notebooks/Xiaojukeji%20Algorithm%20Competition/1.a.%20Export%20to%20Google%20BigQuery%20-%20test%20data.ipynb#" role="button" class="ui-button" title="Tooltip will linger for 10 seconds while you type" style="display: none;"><span class="ui-icon ui-icon-clock">Close</span></a></div><div class="pretooltiparrow"></div><div class="tooltiptext smalltooltip"></div></div>
            </div>
          </div>
        </div>
      </div>
      <div id="sidebarArea">
        <div id="sidebarToolbar">
          <div class="btn-toolbar pull-left">
            <div class="btn-group">
              <button id="toggleSidebarButton" type="button" class="btn" title="Toggle the size of the sidebar">
                <span class="fa fa-chevron-right fa-flip-horizontal"></span>
              </button>
            </div>
            <div class="btn-group">
              <button id="navigationButton" type="button" class="btn">Navigation</button>
              <button id="helpButton" type="button" class="btn active">Help</button>
            </div>
          </div>
        </div>
        <div id="sidebarContent">
          <div id="navigation" style="display: none"><div><b>Notebook Outline</b></div><br><div><a href="https://main-dot-datalab-dot-datalab-projects-1331.appspot.com/notebooks/Xiaojukeji%20Algorithm%20Competition/1.a.%20Export%20to%20Google%20BigQuery%20-%20test%20data.ipynb#" cellindex="5">Process Training Data</a></div><div>&nbsp;&nbsp;&nbsp;<a href="https://main-dot-datalab-dot-datalab-projects-1331.appspot.com/notebooks/Xiaojukeji%20Algorithm%20Competition/1.a.%20Export%20to%20Google%20BigQuery%20-%20test%20data.ipynb#" cellindex="6">Districts</a></div><div>&nbsp;&nbsp;&nbsp;<a href="https://main-dot-datalab-dot-datalab-projects-1331.appspot.com/notebooks/Xiaojukeji%20Algorithm%20Competition/1.a.%20Export%20to%20Google%20BigQuery%20-%20test%20data.ipynb#" cellindex="9">Weather</a></div><div>&nbsp;&nbsp;&nbsp;<a href="https://main-dot-datalab-dot-datalab-projects-1331.appspot.com/notebooks/Xiaojukeji%20Algorithm%20Competition/1.a.%20Export%20to%20Google%20BigQuery%20-%20test%20data.ipynb#" cellindex="13">Traffic</a></div><div>&nbsp;&nbsp;&nbsp;<a href="https://main-dot-datalab-dot-datalab-projects-1331.appspot.com/notebooks/Xiaojukeji%20Algorithm%20Competition/1.a.%20Export%20to%20Google%20BigQuery%20-%20test%20data.ipynb#" cellindex="17">POIs</a></div><div>&nbsp;&nbsp;&nbsp;<a href="https://main-dot-datalab-dot-datalab-projects-1331.appspot.com/notebooks/Xiaojukeji%20Algorithm%20Competition/1.a.%20Export%20to%20Google%20BigQuery%20-%20test%20data.ipynb#" cellindex="22">Orders</a></div></div>
          <div id="help">
            <p><b>Help for Python APIs</b></p>
            <p>
              You can enter <code>class?</code> or <code>member?</code> within a code cell in the
              notebook to get help on a Python API.
            </p>
            <br>
            <p>
              For example, try <code>str?</code> to get help information on the built-in Python
              method to convert a value to its string representation.
            </p>
            <br>
            <p>
              Additional help topics and links are also available from the menu off the Help
              icon on the top of the page.
            </p>
            <br>
            <p><b>Docs and Samples</b></p>
            <p>
              The <a href="https://main-dot-datalab-dot-datalab-projects-1331.appspot.com/notebooks/datalab/Readme.ipynb" target"_blank"="">Cloud Datalab Guide</a> featuring
              documentation and sample notebooks is also a great way to check out how you can use Cloud Datalab.
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script src="./1.a. Export to Google BigQuery - test data_files/promise.min.js"></script>
  <script src="./1.a. Export to Google BigQuery - test data_files/socket.io.js"></script>
  <script src="./1.a. Export to Google BigQuery - test data_files/require.js"></script>
  <script>
    window.mathjax_url = '';
    window.sys_info = {};
    require.config({
      baseUrl: '/static/',
      paths: {
        'auth/js/main': 'auth/js/main.min',
        custom : '/custom',
        nbextensions : '/nbextensions',
        widgets : '/deprecatedwidgets',
        kernelspecs : '/kernelspecs',
        underscore : 'components/underscore/underscore-min',
        backbone : 'components/backbone/backbone-min',
        jquery: 'components/jquery/jquery.min',
        bootstrap: 'components/bootstrap/js/bootstrap.min',
        bootstraptour: 'components/bootstrap-tour/build/js/bootstrap-tour.min',
        jqueryui: 'components/jquery-ui/ui/minified/jquery-ui.min',
        moment: 'components/moment/moment',
        codemirror: 'components/codemirror',
        termjs: 'components/term.js/src/term',
      },
      shim: {
        underscore: {
          exports: '_'
        },
        backbone: {
          deps: ["underscore", "jquery"],
          exports: "Backbone"
        },
        bootstrap: {
          deps: ["jquery"],
          exports: "bootstrap"
        },
        bootstraptour: {
          deps: ["bootstrap"],
          exports: "Tour"
        },
        jqueryui: {
          deps: ["jquery"],
          exports: "$"
        }
      }
    });
    require.config({
       map: {
         '*': {
           'contents': 'services/contents',
         }
       }
     });
     window.datalab = {};
  </script>
  <script src="./1.a. Export to Google BigQuery - test data_files/main.min.js" charset="utf-8"></script>
  <script src="./1.a. Export to Google BigQuery - test data_files/api.js" async="true" defer="true"></script>
  <script type="text/fragment" id="cellStatus">
    <div class="status" style="display: none;">
      Running...
      <div class="progress progress-striped active">
        <div class="progress-bar" style="width: 100%"></div>
      </div>
    </div>
  </script>
  <script type="text/fragment" id="shortcutsHelp">
    <p>The notebook has two keyboard modes: Edit mode allows you to type code/text into a cell indicated by a raised cell with a shadow. Command mode allows notebook level actions.</p>
    <br>
    <p><b>Command Mode</b> (<code>Esc</code> to enable)</p>
    <div>
      <div><code>Enter</code>: edit mode</div>
      <div><code>Ctrl/Cmd+S</code>: save notebook</div>
      <div><code>Shift+Enter</code>: run cell, select next</div>
      <div><code>Ctrl+Enter</code>: run cell</div>
      <div><code>y</code>: to code</div>
      <div><code>m</code>: to markdown</div>
      <div><code>Up</code>: select previous cell</div>
      <div><code>Down</code>: select next cell</div>
      <div><code>Ctrl+K</code>: move cell up</div>
      <div><code>Ctrl+J</code>: move cell down</div>
      <div><code>a</code>: insert cell above</div>
      <div><code>b</code>: insert cell below</div>
      <div><code>x</code>: cut cell</div>
      <div><code>c</code>: copy cell</div>
      <div><code>v</code>: paste below</div>
      <div><code>dd</code>: delete cell</div>
      <div><code>z</code>: undo delete cell</div>
    </div>
    <br>
    <p><b>Edit Mode</b> (<code>Enter</code> to enable)</p>
    <div>
      <div><code>Esc</code>: command mode</div>
      <div><code>Ctrl/Cmd+S</code>: save notebook</div>
      <div><code>Shift+Enter</code>: run cell, select next</div>
      <div><code>Tab</code>: code completion or indent</div>
      <div><code>Shift+Tab</code>: quick help</div>
      <div><code>Ctrl/Cmd+]</code>: indent</div>
      <div><code>Ctrl/Cmd+[</code>: dedent</div>
      <div><code>Ctrl/Cmd+a</code>: select all</div>
      <div><code>Ctrl/Cmd+z</code>: undo</div>
      <div><code>Ctrl/Cmd+Shift+z</code>: redo</div>
      <div><code>Ctrl/Cmd+x</code>: cut selected</div>
      <div><code>Ctrl/Cmd+c</code>: copy selected</div>
      <div><code>Ctrl/Cmd+v</code>: paste</div>
    </div>
  </script>
  <script type="text/fragment" id="markdownHelp">
  <b>Markdown Syntax</b><br /><br />
      <b>Headers</b>
<pre># This is a level 1 header.
## This is a level 2 header.
### This is a level 3 header.</pre>
      <b>Emphasis</b>
<pre>*Italic text*
_Also italic_

**Bold text</pre>
      <b>Unordered Lists</b>
<pre>* Item 1
* Item 2
  * Item 2a</pre>
      <b>Ordered Lists</b>
<pre>1. Item 1
2. Item 2
   * Item 2a</pre>
      <b>Links</b>
<pre>http://cloud.google.com - automatic
[Text](url)</pre>
      <b>Images</b>
      <pre>![Alt Text](url)</pre>
      <b>Quoted Text</b>
<pre>&gt; Quoted Line 1
&gt; Quoted Line 2</pre>
      <b>Inline Code</b>
      <pre>Some `code` inline</pre>
      <b>Code Block</b>
<pre>Normal text

    Indented code text</pre>
    </div>
  </script>


</body></html>